<!DOCTYPE html>
<html xmlns="http://www.w3.org/1999/xhtml" xml:lang="en-US" lang="en-US">

<head>
    <!-- Basic Page Needs -->
    <meta charset="utf-8">
    <title>Blushley - Product Management</title>
    <meta name="viewport" content="width=device-width, initial-scale=1, maximum-scale=1">

    <!-- Theme Style -->
    <link rel="stylesheet" type="text/css" href="/admin-css/animate.min.css">
    <link rel="stylesheet" type="text/css" href="/admin-css/animation.css">
    <link rel="stylesheet" type="text/css" href="/admin-css/bootstrap.css">
    <link rel="stylesheet" type="text/css" href="/admin-css/bootstrap-select.min.css">
    <link rel="stylesheet" type="text/css" href="/admin-css/styles.css">
    <link rel="stylesheet" href="https://cdnjs.cloudflare.com/ajax/libs/font-awesome/4.7.0/css/font-awesome.min.css">

    <!-- Font -->
    <link rel="stylesheet" href="/admin-font/fonts.css">

    <!-- Icon -->
    <link rel="stylesheet" href="/admin-icon/style.css">

    <!-- Favicon and Touch Icons  -->
    <link rel="shortcut icon" href="/images/logo/blushley-png-without-shade.png">
    <link rel="apple-touch-icon-precomposed" href="/images/logo/blushley-png-without-shade.png">

    <style>
        /* Status badges */
        .status-badge {
            padding: 4px 8px;
            border-radius: 12px;
            font-size: 12px;
            font-weight: 500;
        }

        .status-badge.active {
            background-color: #e6f7ee;
            color: #10b759;
        }

        .status-badge.inactive {
            background-color: #ffebeb;
            color: #5c4d3b;
        }

        .status-badge.verified {
            background-color: #e6f3ff;
            color: #1890ff;
        }

        .status-badge.pending {
            background-color: #fff7e6;
            color: #fa8c16;
        }

        /* Modern Modal Styles */
        .modal {
            display: none;
            position: fixed;
            z-index: 1000;
            left: 0;
            top: 0;
            width: 100%;
            height: 100%;
            background-color: rgba(0, 0, 0, 0.6);
            backdrop-filter: blur(5px);
            animation: fadeIn 0.3s ease;
        }

        .modal-content {
            background-color: #fff;
            margin: 2% auto;
            border-radius: 16px;
            width: 90%;
            max-width: 900px;
            max-height: 90vh;
            overflow-y: auto;
            box-shadow: 0 20px 60px rgba(0, 0, 0, 0.3);
            animation: slideIn 0.3s ease;
        }

        .modern-modal {
            border: none;
            box-shadow: 0 25px 80px rgba(0, 0, 0, 0.15);
        }

        .modal-header {
            display: flex;
            justify-content: space-between;
            align-items: center;
            padding: 24px 32px;
            border-bottom: 1px solid #e5e7eb;
            background: linear-gradient(135deg, #5c4d3b 0%, #ff8e53 100%);
            border-radius: 16px 16px 0 0;
            color: white;
        }

        .modal-title {
            display: flex;
            align-items: center;
            gap: 12px;
        }

        .modal-title i {
            font-size: 24px;
            color: #fff;
        }

        .modal-title h3 {
            margin: 0;
            font-size: 24px;
            font-weight: 600;
            color: white;
        }

        .close-btn {
            background: rgba(255, 255, 255, 0.2);
            border: none;
            border-radius: 50%;
            width: 40px;
            height: 40px;
            display: flex;
            align-items: center;
            justify-content: center;
            cursor: pointer;
            transition: all 0.3s ease;
            color: white;
        }

        .close-btn:hover {
            background: rgba(255, 255, 255, 0.3);
            transform: scale(1.1);
        }

        .modal-body {
            padding: 32px;
        }

        .form-section {
            margin-bottom: 32px;
            background: #f8fafc;
            border-radius: 12px;
            padding: 24px;
            border: 1px solid #e2e8f0;
        }

        .section-header {
            margin-bottom: 20px;
            padding-bottom: 12px;
            border-bottom: 2px solid #e2e8f0;
        }

        .section-header h4 {
            margin: 0;
            font-size: 18px;
            font-weight: 600;
            color: #1e293b;
            display: flex;
            align-items: center;
            gap: 8px;
        }

        .section-header i {
            color: #5c4d3b;
            font-size: 20px;
        }

        .form-grid {
            display: grid;
            grid-template-columns: repeat(auto-fit, minmax(250px, 1fr));
            gap: 20px;
            margin-bottom: 20px;
        }

        .form-group {
            margin-bottom: 20px;
        }

        .form-group label {
            display: block;
            margin-bottom: 8px;
            font-weight: 600;
            color: #374151;
            font-size: 14px;
        }

        .form-group input,
        .form-group select,
        .form-group textarea {
            width: 100%;
            padding: 12px 16px;
            border: 2px solid #e2e8f0;
            border-radius: 8px;
            font-size: 14px;
            transition: all 0.3s ease;
            background: white;
        }

        .form-group input:focus,
        .form-group select:focus,
        .form-group textarea:focus {
            outline: none;
            border-color: #5c4d3b;
            box-shadow: 0 0 0 3px rgba(255, 107, 147, 0.1);
        }

        .features-grid {
            display: grid;
            grid-template-columns: repeat(auto-fit, minmax(200px, 1fr));
            gap: 16px;
        }

        .feature-item {
            display: flex;
            align-items: center;
            gap: 8px;
            padding: 12px;
            background: white;
            border-radius: 8px;
            border: 2px solid #e2e8f0;
            transition: all 0.3s ease;
        }

        .feature-item:hover {
            border-color: #5c4d3b;
            background: #f8fafc;
        }

        .feature-item input[type="checkbox"] {
            width: 18px;
            height: 18px;
            margin: 0;
        }

        .feature-item label {
            margin: 0;
            cursor: pointer;
            font-weight: 500;
            color: #374151;
        }

        .file-upload-area {
            border: 2px dashed #cbd5e1;
            border-radius: 12px;
            padding: 40px 20px;
            text-align: center;
            background: #f8fafc;
            transition: all 0.3s ease;
            cursor: pointer;
            position: relative;
        }

        .file-upload-area:hover {
            border-color: #5c4d3b;
            background: #f1f5f9;
        }

        .file-upload-area input[type="file"] {
            position: absolute;
            top: 0;
            left: 0;
            width: 100%;
            height: 100%;
            opacity: 0;
            cursor: pointer;
        }

        .upload-content i {
            font-size: 48px;
            color: #94a3b8;
            margin-bottom: 16px;
        }

        .upload-content p {
            margin: 0 0 8px 0;
            font-weight: 600;
            color: #374151;
        }

        .upload-content small {
            color: #64748b;
        }

        .image-preview-grid {
            display: grid;
            grid-template-columns: repeat(auto-fill, minmax(120px, 1fr));
            gap: 12px;
            margin-top: 16px;
        }

        .image-preview-grid img {
            width: 100%;
            height: 120px;
            object-fit: cover;
            border-radius: 8px;
            border: 2px solid #e2e8f0;
        }

        .status-toggle {
            display: flex;
            align-items: center;
            gap: 12px;
        }

        .toggle-label {
            display: flex;
            align-items: center;
            gap: 8px;
            cursor: pointer;
        }

        .toggle-slider {
            position: relative;
            width: 50px;
            height: 24px;
            background: #cbd5e1;
            border-radius: 12px;
            transition: all 0.3s ease;
        }

        .toggle-slider::before {
            content: '';
            position: absolute;
            top: 2px;
            left: 2px;
            width: 20px;
            height: 20px;
            background: white;
            border-radius: 50%;
            transition: all 0.3s ease;
        }

        input[type="checkbox"]:checked+.toggle-label .toggle-slider {
            background: #10b981;
        }

        input[type="checkbox"]:checked+.toggle-label .toggle-slider::before {
            transform: translateX(26px);
        }

        .form-actions {
            display: flex;
            justify-content: flex-end;
            gap: 16px;
            padding-top: 24px;
            border-top: 1px solid #e2e8f0;
            margin-top: 32px;
        }

        .btn {
            padding: 12px 24px;
            border-radius: 8px;
            font-weight: 600;
            font-size: 14px;
            cursor: pointer;
            transition: all 0.3s ease;
            display: flex;
            align-items: center;
            gap: 8px;
            border: none;
        }

        .btn-secondary {
            background: #f1f5f9;
            color: #64748b;
            border: 2px solid #e2e8f0;
        }

        .btn-secondary:hover {
            background: #e2e8f0;
            color: #475569;
        }

        .btn-primary {
            background: linear-gradient(135deg, #5c4d3b 0%, #ff8e53 100%);
            color: white;
        }

        .btn-primary:hover {
            transform: translateY(-2px);
            box-shadow: 0 8px 25px rgba(255, 107, 147, 0.3);
        }

        @keyframes fadeIn {
            from {
                opacity: 0;
            }

            to {
                opacity: 1;
            }
        }

        @keyframes slideIn {
            from {
                opacity: 0;
                transform: translateY(-50px);
            }

            to {
                opacity: 1;
                transform: translateY(0);
            }
        }

        /* Product Card Styles */
        .products-container {
            display: grid;
            grid-template-columns: repeat(auto-fill, minmax(300px, 1fr));
            gap: 20px;
            padding: 20px;
        }

        .product-card {
            border: 1px solid #e0e0e0;
            border-radius: 8px;
            overflow: hidden;
            box-shadow: 0 2px 8px rgba(0, 0, 0, 0.1);
            transition: all 0.3s ease;
            background: white;
        }

        .product-card:hover {
            box-shadow: 0 4px 12px rgba(0, 0, 0, 0.15);
            transform: translateY(-2px);
        }

        .card-header {
            padding: 16px;
            background: #f8f9fa;
            border-bottom: 1px solid #e0e0e0;
            display: flex;
            justify-content: space-between;
            align-items: center;
        }

        .card-title {
            margin: 0;
            font-size: 18px;
            font-weight: 600;
            color: #333;
        }

        .card-image {
            height: 200px;
            overflow: hidden;
        }

        .card-image img {
            width: 100%;
            height: 100%;
            object-fit: cover;
            transition: transform 0.3s ease;
        }

        .product-card:hover .card-image img {
            transform: scale(1.05);
        }

        .card-body {
            padding: 16px;
        }

        .detail-row {
            display: flex;
            margin-bottom: 8px;
            align-items: center;
        }

        .detail-label {
            font-weight: 600;
            min-width: 100px;
            color: #666;
            font-size: 14px;
        }

        .detail-value {
            flex: 1;
            color: #333;
            font-size: 14px;
        }

        .expanded-details {
            max-height: 0;
            overflow: hidden;
            transition: max-height 0.3s ease;
        }

        .expanded-details.active {
            max-height: 1000px;
            padding: 16px;
            background: #f9f9f9;
            border-top: 1px solid #e0e0e0;
        }

        .detail-section {
            margin-bottom: 16px;
        }

        .detail-section h4 {
            margin: 0 0 8px 0;
            font-size: 16px;
            color: #333;
        }

        .detail-grid {
            display: grid;
            grid-template-columns: repeat(auto-fit, minmax(200px, 1fr));
            gap: 12px;
        }

        .detail-item {
            display: flex;
            flex-direction: column;
        }

        .detail-item .detail-label {
            font-size: 12px;
            color: #666;
            margin-bottom: 4px;
        }

        .detail-item .detail-value {
            font-size: 14px;
            color: #333;
        }

        .included-list {
            list-style: none;
            padding: 0;
            margin: 0;
        }

        .included-list li {
            padding: 4px 0;
            border-bottom: 1px solid #eee;
        }

        .included-list li:last-child {
            border-bottom: none;
        }

        .card-footer {
            padding: 12px 16px;
            border-top: 1px solid #e0e0e0;
            display: flex;
            justify-content: space-between;
            align-items: center;
        }

        .details-btn {
            background: none;
            border: none;
            color: #ff6b93;
            cursor: pointer;
            font-size: 14px;
            font-weight: 500;
        }

        .card-actions {
            display: flex;
            gap: 8px;
        }

        .card-actions .item {
            width: 32px;
            height: 32px;
            border: none;
            border-radius: 6px;
            display: flex;
            align-items: center;
            justify-content: center;
            cursor: pointer;
            transition: all 0.3s ease;
        }

        .card-actions .item.edit {
            background: rgba(59, 130, 246, 0.1);
            color: #3b82f6;
        }

        .card-actions .item.verify {
            background: rgba(34, 197, 94, 0.1);
            color: #22c55e;
        }

        .card-actions .item.toggle {
            background: rgba(245, 158, 11, 0.1);
            color: #f59e0b;
        }

        .card-actions .item.trash {
            background: rgba(239, 68, 68, 0.1);
            color: #5c4d3b;
        }

        .card-actions .item:hover {
            transform: scale(1.1);
        }

        /* Current Images Preview */
        .current-images {
            display: flex;
            flex-wrap: wrap;
            gap: 10px;
            margin-top: 10px;
        }

        .current-image {
            position: relative;
            width: 100px;
            height: 100px;
        }

        .current-image img {
            width: 100%;
            height: 100%;
            object-fit: cover;
            border-radius: 4px;
        }

        .current-image .remove-img {
            position: absolute;
            top: 5px;
            right: 5px;
            background: rgba(255, 0, 0, 0.7);
            color: white;
            border: none;
            width: 20px;
            height: 20px;
            border-radius: 50%;
            display: flex;
            align-items: center;
            justify-content: center;
            cursor: pointer;
            font-size: 12px;
        }

        /* Beauty Tips Styles */
        .beauty-tips-container {
            background: #fff;
            border-radius: 8px;
            border: 1px solid #e2e8f0;
            margin-bottom: 20px;
        }

        .beauty-tip-item {
            padding: 20px;
            border-bottom: 1px solid #e2e8f0;
            background: #f8fafc;
            border-radius: 8px;
            margin-bottom: 16px;
        }

        .beauty-tip-item:last-child {
            border-bottom: none;
            margin-bottom: 0;
        }

        .beauty-tip-header {
            display: flex;
            align-items: flex-start;
            gap: 12px;
            margin-bottom: 16px;
        }

        .beauty-tip-item .tip-number {
            background: linear-gradient(135deg, #5c4d3b 0%, #ff8e53 100%);
            color: white;
            width: 28px;
            height: 28px;
            border-radius: 50%;
            display: flex;
            align-items: center;
            justify-content: center;
            font-size: 14px;
            font-weight: 600;
            flex-shrink: 0;
        }

        .beauty-tip-content {
            flex: 1;
        }

        .beauty-tip-content input,
        .beauty-tip-content textarea {
            width: 100%;
            padding: 12px 16px;
            border: 2px solid #e2e8f0;
            border-radius: 8px;
            font-size: 14px;
            margin-bottom: 12px;
            transition: all 0.3s ease;
            background: white;
        }

        .beauty-tip-content input:focus,
        .beauty-tip-content textarea:focus {
            outline: none;
            border-color: #5c4d3b;
            box-shadow: 0 0 0 3px rgba(255, 107, 147, 0.1);
        }

        .steps-container {
            margin-top: 16px;
        }

        .step-item {
            display: flex;
            align-items: flex-start;
            gap: 12px;
            margin-bottom: 12px;
            padding: 12px;
            background: white;
            border-radius: 6px;
            border: 1px solid #e2e8f0;
        }

        .step-number {
            background: #5c4d3b;
            color: white;
            width: 24px;
            height: 24px;
            border-radius: 50%;
            display: flex;
            align-items: center;
            justify-content: center;
            font-size: 12px;
            font-weight: 600;
            flex-shrink: 0;
            margin-top: 2px;
        }

        .step-content {
            flex: 1;
        }

        .step-content input {
            width: 100%;
            padding: 8px 12px;
            border: 1px solid #d1d5db;
            border-radius: 6px;
            font-size: 14px;
        }

        .step-actions {
            display: flex;
            gap: 8px;
            margin-top: 8px;
        }

        .beauty-tip-actions {
            display: flex;
            gap: 8px;
            margin-top: 16px;
            flex-wrap: wrap;
        }

        .beauty-tip-actions button,
        .step-actions button {
            padding: 8px 16px;
            border: none;
            border-radius: 6px;
            font-size: 12px;
            font-weight: 500;
            cursor: pointer;
            transition: all 0.3s ease;
            display: flex;
            align-items: center;
            gap: 6px;
        }

        .add-tip-btn {
            background: #10b981;
            color: white;
        }

        .add-tip-btn:hover {
            background: #059669;
            transform: translateY(-1px);
        }

        .remove-tip-btn {
            background: #ef4444;
            color: white;
        }

        .remove-tip-btn:hover {
            background: #dc2626;
            transform: translateY(-1px);
        }

        .move-tip-btn {
            background: #f59e0b;
            color: white;
        }

        .move-tip-btn:hover {
            background: #d97706;
            transform: translateY(-1px);
        }

        .add-step-btn {
            background: #3b82f6;
            color: white;
        }

        .add-step-btn:hover {
            background: #2563eb;
            transform: translateY(-1px);
        }

        .remove-step-btn {
            background: #6b7280;
            color: white;
        }

        .remove-step-btn:hover {
            background: #4b5563;
            transform: translateY(-1px);
        }

        .beauty-tips-header {
            display: flex;
            justify-content: space-between;
            align-items: center;
            margin-bottom: 20px;
        }

        .beauty-tips-title {
            font-size: 18px;
            font-weight: 600;
            color: #1e293b;
        }

        .add-new-tip-btn {
            background: linear-gradient(135deg, #5c4d3b 0%, #ff8e53 100%);
            color: white;
            border: none;
            padding: 10px 20px;
            border-radius: 8px;
            font-size: 14px;
            font-weight: 500;
            cursor: pointer;
            display: flex;
            align-items: center;
            gap: 8px;
            transition: all 0.3s ease;
        }

        .add-new-tip-btn:hover {
            transform: translateY(-2px);
            box-shadow: 0 8px 25px rgba(255, 107, 147, 0.3);
        }

        /* Product Card Beauty Tips Display */
        .beauty-tips-display {
            margin-top: 16px;
            padding: 16px;
            background: #f8fafc;
            border-radius: 8px;
            border-left: 4px solid #5c4d3b;
        }

        .beauty-tips-display h5 {
            margin: 0 0 12px 0;
            font-size: 16px;
            font-weight: 600;
            color: #1e293b;
            display: flex;
            align-items: center;
            gap: 8px;
        }

        .beauty-tips-display h5 i {
            color: #5c4d3b;
        }

        .beauty-tip-display-item {
            margin-bottom: 16px;
            padding-bottom: 16px;
            border-bottom: 1px solid #e2e8f0;
        }

        .beauty-tip-display-item:last-child {
            margin-bottom: 0;
            padding-bottom: 0;
            border-bottom: none;
        }

        .beauty-tip-title {
            font-weight: 600;
            color: #374151;
            margin-bottom: 8px;
            font-size: 14px;
        }

        .beauty-tip-description {
            color: #6b7280;
            margin-bottom: 12px;
            font-size: 13px;
            line-height: 1.5;
        }

        .beauty-tip-steps {
            list-style: none;
            padding: 0;
            margin: 0;
        }

        .beauty-tip-steps li {
            padding: 6px 0;
            font-size: 13px;
            color: #374151;
            position: relative;
            padding-left: 20px;
            line-height: 1.4;
        }

        .beauty-tip-steps li:before {
            content: "•";
            color: #5c4d3b;
            font-weight: bold;
            position: absolute;
            left: 8px;
        }

        .no-tips-message {
            text-align: center;
            color: #6b7280;
            font-style: italic;
            padding: 20px;
        }

        /* Responsive Design */
        @media (max-width: 768px) {
            .modal-content {
                width: 95%;
                margin: 5% auto;
                max-height: 95vh;
            }

            .modal-header {
                padding: 20px;
            }

            .modal-body {
                padding: 20px;
            }

            .form-grid {
                grid-template-columns: 1fr;
            }

            .features-grid {
                grid-template-columns: 1fr;
            }

            .form-actions {
                flex-direction: column;
            }

            .btn {
                width: 100%;
                justify-content: center;
            }

            .products-container {
                grid-template-columns: 1fr;
                padding: 10px;
            }

            .card-footer {
                flex-direction: column;
                gap: 12px;
                align-items: stretch;
            }

            .card-actions {
                justify-content: center;
            }

            .beauty-tip-item {
                padding: 16px;
            }

            .beauty-tip-header {
                flex-direction: column;
                gap: 8px;
            }

            .beauty-tip-actions {
                flex-direction: column;
            }

            .beauty-tip-actions button {
                width: 100%;
                justify-content: center;
            }

            .beauty-tips-header {
                flex-direction: column;
                gap: 12px;
                align-items: stretch;
            }

            .add-new-tip-btn {
                width: 100%;
                justify-content: center;
            }
        }

        @media (max-width: 480px) {
            .modal-content {
                width: 100%;
                margin: 0;
                border-radius: 0;
                max-height: 100vh;
            }

            .modal-header {
                border-radius: 0;
            }
        }
    </style>
      <style>
        /* Large Modal */
        .large-modal {
            max-width: 900px;
            max-height: 90vh;
            overflow-y: auto;
        }

        /* Multi-Select Styles */
        .multi-select-container {
            position: relative;
            width: 100%;
        }

        .selected-items-display {
            min-height: 44px;
            border: 1px solid #e2e8f0;
            border-radius: 8px;
            padding: 8px 12px;
            background: white;
            display: flex;
            flex-wrap: wrap;
            gap: 8px;
            align-items: center;
            margin-bottom: 8px;
        }

        .selected-item {
            background: #e0f2fe;
            color: #0369a1;
            padding: 4px 8px;
            border-radius: 6px;
            font-size: 14px;
            display: flex;
            align-items: center;
            gap: 4px;
        }

        .selected-item .remove-item {
            background: none;
            border: none;
            color: #0369a1;
            cursor: pointer;
            padding: 2px;
            border-radius: 3px;
        }

        .selected-item .remove-item:hover {
            background: #bae6fd;
        }

        .select-trigger-btn {
            width: 100%;
            padding: 12px;
            border: 1px solid #e2e8f0;
            border-radius: 8px;
            background: white;
            display: flex;
            justify-content: space-between;
            align-items: center;
            cursor: pointer;
            transition: all 0.2s ease;
        }

        .select-trigger-btn:hover {
            border-color: #6366f1;
        }

        .dropdown-options {
            position: absolute;
            top: 100%;
            left: 0;
            right: 0;
            background: white;
            border: 1px solid #e2e8f0;
            border-radius: 8px;
            box-shadow: 0 4px 12px rgba(0, 0, 0, 0.1);
            z-index: 1000;
            display: none;
            max-height: 300px;
            overflow-y: auto;
        }

        .dropdown-options.show {
            display: block;
        }

        .dropdown-search {
            padding: 12px;
            border-bottom: 1px solid #f1f5f9;
        }

        .dropdown-search input {
            width: 100%;
            padding: 8px 12px;
            border: 1px solid #e2e8f0;
            border-radius: 6px;
        }

        .options-list {
            padding: 8px 0;
        }

        .option-item {
            padding: 8px 12px;
            cursor: pointer;
            transition: background-color 0.2s ease;
        }

        .option-item:hover {
            background: #f8fafc;
        }

        .option-content {
            margin-left: 8px;
        }

        .option-title {
            font-weight: 500;
            color: #1e293b;
        }

        .option-description {
            font-size: 12px;
            color: #64748b;
            margin-top: 2px;
        }

        .dropdown-actions {
            padding: 12px;
            border-top: 1px solid #f1f5f9;
            display: flex;
            gap: 8px;
        }

        /* Addable List Styles */
        .addable-list-container {
            border: 1px solid #e2e8f0;
            border-radius: 8px;
            overflow: hidden;
        }

        .input-with-button {
            display: flex;
            border-bottom: 1px solid #f1f5f9;
        }

        .input-with-button input {
            flex: 1;
            border: none;
            padding: 12px;
            outline: none;
        }

        .add-item-btn {
            background: #6366f1;
            color: white;
            border: none;
            padding: 0 16px;
            cursor: pointer;
            transition: background-color 0.2s ease;
        }

        .add-item-btn:hover {
            background: #4f46e5;
        }

        .items-list {
            max-height: 200px;
            overflow-y: auto;
        }

        .list-item {
            display: flex;
            justify-content: space-between;
            align-items: center;
            padding: 8px 12px;
            border-bottom: 1px solid #f8fafc;
        }

        .list-item:last-child {
            border-bottom: none;
        }

        .list-item .remove-item {
            background: none;
            border: none;
            color: #64748b;
            cursor: pointer;
            padding: 4px;
            border-radius: 4px;
        }

        .list-item .remove-item:hover {
            background: #fecaca;
            color: #dc2626;
        }

        /* Variants Styles */
        .variant-section {
            background: #f8fafc;
            border: 1px solid #e2e8f0;
            border-radius: 8px;
            padding: 16px;
            margin-bottom: 16px;
        }

        .variant-header {
            display: flex;
            justify-content: space-between;
            align-items: center;
            margin-bottom: 16px;
            padding-bottom: 12px;
            border-bottom: 1px solid #e2e8f0;
        }

        .variant-header h5 {
            margin: 0;
            color: #374151;
        }

        .variant-options {
            margin-top: 16px;
        }

        .options-header {
            display: flex;
            justify-content: space-between;
            align-items: center;
            margin-bottom: 12px;
        }

        .variant-option {
            background: white;
            border: 1px solid #e2e8f0;
            border-radius: 6px;
            padding: 16px;
            margin-bottom: 12px;
        }

        .option-header {
            display: flex;
            justify-content: space-between;
            align-items: center;
            margin-bottom: 12px;
        }

        .option-header h6 {
            margin: 0;
            color: #475569;
        }

        .no-variants-message {
            text-align: center;
            padding: 40px 20px;
            color: #64748b;
        }

        .no-variants-message i {
            font-size: 48px;
            margin-bottom: 16px;
            color: #cbd5e1;
        }

        /* Dimensions Grid */
        .dimensions-grid {
            display: grid;
            grid-template-columns: repeat(3, 1fr);
            gap: 12px;
        }

        .dimension-input {
            text-align: center;
        }

        .dimension-input input {
            width: 100%;
            text-align: center;
        }

        .dimension-input label {
            display: block;
            margin-top: 4px;
            font-size: 12px;
            color: #64748b;
        }

        /* Enhanced Image Preview Styles */
.image-preview-grid {
    display: grid;
    grid-template-columns: repeat(auto-fill, minmax(150px, 1fr));
    gap: 15px;
    margin-top: 15px;
}

.preview-image {
    position: relative;
    border: 2px solid #e9ecef;
    border-radius: 8px;
    overflow: hidden;
    transition: all 0.3s ease;
}

.preview-image:hover {
    border-color: #007bff;
    transform: translateY(-2px);
    box-shadow: 0 4px 12px rgba(0, 0, 0, 0.15);
}

.preview-image .image-wrapper {
    position: relative;
    aspect-ratio: 1;
    overflow: hidden;
}

.preview-image img {
    width: 100%;
    height: 100%;
    object-fit: cover;
    display: block;
}

.preview-image .image-overlay {
    position: absolute;
    top: 8px;
    left: 8px;
    background: rgba(0, 0, 0, 0.7);
    color: white;
    padding: 4px 8px;
    border-radius: 4px;
    font-size: 12px;
    font-weight: bold;
}

.preview-controls {
    display: flex;
    justify-content: center;
    padding: 8px;
    background: #f8f9fa;
    border-top: 1px solid #e9ecef;
    gap: 5px;
}

.preview-controls .move-btn,
.preview-controls .remove-preview {
    background: white;
    border: 1px solid #dee2e6;
    border-radius: 4px;
    padding: 6px;
    cursor: pointer;
    transition: all 0.2s ease;
    display: flex;
    align-items: center;
    justify-content: center;
}

.preview-controls .move-btn:hover:not(:disabled),
.preview-controls .remove-preview:hover:not(:disabled) {
    background: #007bff;
    color: white;
    border-color: #007bff;
}

.preview-controls .move-btn:disabled,
.preview-controls .remove-preview:disabled {
    opacity: 0.5;
    cursor: not-allowed;
}

.preview-controls .remove-preview:hover:not(:disabled) {
    background: #dc3545;
    border-color: #dc3545;
}

.file-upload-area.highlight {
    border-color: #007bff;
    background-color: #f8f9ff;
}

.no-images-message {
    text-align: center;
    padding: 40px;
    color: #6c757d;
    font-style: italic;
}

        /* File Upload Area */
        .file-upload-area {
            border: 2px dashed #d1d5db;
            border-radius: 8px;
            padding: 40px 20px;
            text-align: center;
            transition: all 0.3s ease;
            cursor: pointer;
            position: relative;
        }

        .file-upload-area:hover {
            border-color: #6366f1;
            background: #f8fafc;
        }

        .file-upload-area input[type="file"] {
            position: absolute;
            top: 0;
            left: 0;
            width: 100%;
            height: 100%;
            opacity: 0;
            cursor: pointer;
        }

        .upload-content i {
            font-size: 48px;
            color: #9ca3af;
            margin-bottom: 16px;
        }

        .file-types {
            font-size: 12px;
            color: #6b7280;
            margin-top: 8px;
        }

        /* Checkbox Styles */
        .checkbox-label {
            display: flex;
            align-items: flex-start;
            gap: 8px;
            cursor: pointer;
        }

        .checkbox-label input[type="checkbox"] {
            display: none;
        }

        .checkmark {
            width: 18px;
            height: 18px;
            border: 2px solid #d1d5db;
            border-radius: 4px;
            position: relative;
            flex-shrink: 0;
            margin-top: 2px;
        }

        .checkbox-label input[type="checkbox"]:checked+.checkmark {
            background: #6366f1;
            border-color: #6366f1;
        }

        .checkbox-label input[type="checkbox"]:checked+.checkmark:after {
            content: '✓';
            position: absolute;
            color: white;
            font-size: 12px;
            font-weight: bold;
            top: 50%;
            left: 50%;
            transform: translate(-50%, -50%);
        }

        /* Responsive Design */
        @media (max-width: 768px) {
            .large-modal {
                margin: 20px;
                max-width: calc(100% - 40px);
            }

            .form-grid {
                grid-template-columns: 1fr;
            }

            .dimensions-grid {
                grid-template-columns: 1fr;
            }

            .variant-header {
                flex-direction: column;
                gap: 12px;
                align-items: flex-start;
            }
        }
        /* Variant Image Preview Styles */
.variant-preview-image {
    max-width: 120px;
}

.variant-preview-image .image-wrapper {
    height: 100px;
}

.option-images-preview {
    grid-template-columns: repeat(auto-fill, minmax(120px, 1fr));
    gap: 10px;
    margin-top: 10px;
}

.option-images-preview .preview-image {
    border: 1px solid #ddd;
    border-radius: 4px;
    padding: 5px;
}

.option-images-preview .preview-controls {
    padding: 5px;
    gap: 2px;
}

.option-images-preview .remove-preview {
    padding: 4px;
    font-size: 12px;
}
    </style>
</head>

<body class="body">

    <!-- #wrapper -->
    <div id="wrapper">
        <!-- #page -->
        <div id="page" class="">
            <!-- layout-wrap -->
            <div class="layout-wrap loader-off">
                <!-- preload -->
                <div id="preload" class="preload-container">
                    <div class="preloading">
                        <span></span>
                    </div>
                </div>
                <!-- /preload -->
                <!-- section-menu-left -->
                <div class="section-menu-left">
                    <div class="box-logo">
                        <a href="/admin/dashboard" id="site-logo-inner">
                            <img style="width:60px;" id="logo_header" alt="logo"
                                src="/images/logo/blushley-png-without-shade.png" data-light="/images/surya-logo.png"
                                data-dark="/images/surya-logo.png">
                        </a>
                        <div class="button-show-hide">
                            <i class="icon-chevron-left"></i>
                        </div>
                    </div>
                    <div class="section-menu-left-wrap">
                        <div class="center">
                            <div class="center-item">
                                <ul>
                                    <li class="menu-item">
                                        <a href="/admin/dashboard">
                                            <div class="icon">
                                                <svg width="24" height="24" viewBox="0 0 24 24" fill="none"
                                                    xmlns="http://www.w3.org/2000/svg">
                                                    <path fill-rule="evenodd" clip-rule="evenodd"
                                                        d="M12.2652 3.57566C12.1187 3.42921 11.8813 3.42921 11.7348 3.57566L5.25 10.0605V19.8748C5.25 20.0819 5.41789 20.2498 5.625 20.2498H9V16.1248C9 15.0893 9.83947 14.2498 10.875 14.2498H13.125C14.1605 14.2498 15 15.0893 15 16.1248V20.2498H18.375C18.5821 20.2498 18.75 20.0819 18.75 19.8748V10.0605L12.2652 3.57566ZM20.25 11.5605L21.2197 12.5302C21.5126 12.8231 21.9874 12.8231 22.2803 12.5302C22.5732 12.2373 22.5732 11.7624 22.2803 11.4695L13.3258 2.51499C12.5936 1.78276 11.4064 1.78276 10.6742 2.515L1.71967 11.4695C1.42678 11.7624 1.42678 12.2373 1.71967 12.5302C2.01256 12.8231 2.48744 12.8231 2.78033 12.5302L3.75 11.5605V19.8748C3.75 20.9104 4.58947 21.7498 5.625 21.7498H18.375C19.4105 21.7498 20.25 20.9104 20.25 19.8748V11.5605ZM13.5 20.2498H10.5V16.1248C10.5 15.9177 10.6679 15.7498 10.875 15.7498H13.125C13.3321 15.7498 13.5 15.9177 13.5 16.1248V20.2498Z"
                                                        fill="#111111" />
                                                </svg>
                                            </div>
                                            <div class="text">Admin Dashboard</div>
                                        </a>
                                    </li>

                                    <li class="menu-item ">
                                        <a href="/admin/categories" class="menu-item-button">
                                            <div class="icon"><i class="icon-folder"></i></div>
                                            <div class="text">Category Management</div>
                                        </a>
                                    </li>

                                    <li class="menu-item active">
                                        <a href="/admin/products" class="menu-item-button">
                                            <div class="icon"><i class="icon-shopping-bag"></i></div>
                                            <div class="text">Product Management</div>
                                        </a>
                                    </li>
                                    <li class="menu-item">
                                        <a href="/admin/beautyTips" class="menu-item-button">
                                            <div class="icon"><i class="icon-shopping-bag"></i></div>
                                            <div class="text">beautyTip Management</div>
                                        </a>
                                    </li>
                                    <li class="menu-item">
                                        <a href="/admin/reseller_products" class="menu-item-button">
                                            <div class="icon"><i class="icon-heart"></i></div>
                                            <div class="text">Sellers Management</div>
                                        </a>
                                    </li>
                                    <li class="menu-item">
                                        <a href="/admin/orders" class="menu-item-button">
                                            <div class="icon"><i class="icon-shopping-cart"></i></div>
                                            <div class="text">Order Management</div>
                                        </a>
                                    </li>

                                    <li class="menu-item ">
                                        <a href="/admin/bookings" class="menu-item-button">
                                            <div class="icon"><i class="icon-calendar"></i></div>
                                            <div class="text">Booking Management</div>
                                        </a>
                                    </li>
                                    <li class="menu-item">
                                        <a href="/admin/saloon" class="menu-item-button">
                                            <div class="icon"><i class="icon-scissors"></i></div>
                                            <div class="text">Salons Management</div>
                                        </a>
                                    </li>

                                    <li class="menu-item">
                                        <a href="/admin/freelance" class="menu-item-button">
                                            <div class="icon"><i class="icon-users"></i></div>
                                            <div class="text">Freelance Management</div>
                                        </a>
                                    </li>
                                    <li class="menu-item ">
                                        <a href="/admin/users" class="menu-item-button">
                                            <div class="icon"><i class="icon-users"></i></div>
                                            <div class="text">User Management</div>
                                        </a>
                                    </li>
                                    <li class="menu-item">
                                        <a href="/admin/banner" class="menu-item-button">
                                            <div class="icon"><i class="icon-image"></i></div>
                                            <div class="text">Banner Management</div>
                                        </a>
                                    </li>

                                    <li class="menu-item">
                                        <a href="/admin/testimonials" class="menu-item-button">
                                            <div class="icon"><i class="fa fa-star-o"></i></div>
                                            <div class="text">Testimonials Management</div>
                                        </a>
                                    </li>

                                    <li class="menu-item">
                                        <a href="/admin/blogs" class="menu-item-button">
                                            <div class="icon"><i class="icon-book-open"></i></div>
                                            <div class="text">Blogs Management</div>
                                        </a>
                                    </li>

                                    <li class="menu-item">
                                        <a href="/logout">
                                            <div class="icon">
                                                <svg width="24" height="22" viewBox="0 0 20 20" fill="none"
                                                    xmlns="http://www.w3.org/2000/svg">
                                                    <path
                                                        d="M8.125 18.6875C8.125 18.903 8.0394 19.1097 7.88702 19.262C7.73465 19.4144 7.52799 19.5 7.3125 19.5H1.625C1.19402 19.5 0.780698 19.3288 0.475951 19.024C0.171205 18.7193 0 18.306 0 17.875V1.625C0 1.19402 0.171205 0.780698 0.475951 0.475951C0.780698 0.171205 1.19402 0 1.625 0H7.3125C7.52799 0 7.73465 0.0856026 7.88702 0.237976C8.0394 0.390349 8.125 0.597012 8.125 0.8125C8.125 1.02799 8.0394 1.23465 7.88702 1.38702C7.73465 1.5394 7.52799 1.625 7.3125 1.625H1.625V17.875H7.3125C7.52799 17.875 7.73465 17.9606 7.88702 18.113C8.0394 18.2653 8.125 18.472 8.125 18.6875ZM19.2623 9.17516L15.1998 5.11266C15.0474 4.9602 14.8406 4.87455 14.625 4.87455C14.4094 4.87455 14.2026 4.9602 14.0502 5.11266C13.8977 5.26511 13.812 5.47189 13.812 5.6875C13.812 5.90311 13.8977 6.10989 14.0502 6.26234L16.7263 8.9375H7.3125C7.09701 8.9375 6.89035 9.0231 6.73798 9.17548C6.5856 9.32785 6.5 9.53451 6.5 9.75C6.5 9.96549 6.5856 10.1722 6.73798 10.3245C6.89035 10.4769 7.09701 10.5625 7.3125 10.5625H16.7263L14.0502 13.2377C13.8977 13.3901 13.812 13.5969 13.812 13.8125C13.812 14.0281 13.8977 14.2349 14.0502 14.3873C14.2026 14.5398 14.4094 14.6255 14.625 14.6255C14.8406 14.6255 15.0474 14.5398 15.1998 14.3873L19.2623 10.3248C19.3379 10.2494 19.3978 10.1598 19.4387 10.0611C19.4796 9.9625 19.5006 9.85678 19.5006 9.75C19.5006 9.64322 19.4796 9.5375 19.4387 9.43886C19.3978 9.34023 19.3379 9.25062 19.2623 9.17516Z"
                                                        fill="#111111" />
                                                </svg>
                                            </div>
                                            <div class="text">Log out</div>
                                        </a>
                                    </li>
                                </ul>
                            </div>
                        </div>
                    </div>
                </div>
                <!-- /section-menu-left -->
                <!-- section-content-right -->
                <div class="section-content-right">
                    <!-- header-dashboard -->
                    <div class="header-dashboard">
                        <div class="wrap">
                            <div class="header-left">
                                <a href="/admin/dashboard">
                                    <img style="width: 50px;" id="logo_header_mobile" alt=""
                                        src="/images/surya-logo.png" data-light="/images/surya-logo.png"
                                        data-dark="/images/surya-logo.png">
                                </a>
                                <div class="button-show-hide">
                                    <i class="icon-chevron-left"></i>
                                </div>
                            </div>
                            <div class="header-grid">
                                <div class="header-item button-dark-light">
                                    <i class="icon-moon"></i>
                                </div>
                                <div class="header-item button-zoom-maximize">
                                    <div class="">
                                        <i class="icon-maximize"></i>
                                    </div>
                                </div>
                                <div class="popup-wrap user type-header">
                                    <div class="dropdown">
                                        <button class="btn btn-secondary dropdown-toggle" type="button"
                                            id="dropdownMenuButton3" data-bs-toggle="dropdown" aria-expanded="false">
                                            <span class="header-user wg-user">
                                                <span class="image">
                                                    <img src="/images/logo/blushley-png-without-shade.png" alt="">
                                                </span>
                                                <span class="flex flex-column">
                                                    <span class="body-text text-main-dark">Blushley</span>
                                                    <span class="text-tiny">Admin</span>
                                                </span>
                                            </span>
                                        </button>
                                        <ul class="dropdown-menu dropdown-menu-end has-content"
                                            aria-labelledby="dropdownMenuButton3">
                                            <li>
                                                <a href="#" class="user-item">
                                                    <div class="icon">
                                                        <i class="icon-headphones"></i>
                                                    </div>
                                                    <div class="body-title-2">Support</div>
                                                </a>
                                            </li>
                                            <li>
                                                <a href="/logout" class="user-item">
                                                    <div class="icon">
                                                        <i class="icon-log-out"></i>
                                                    </div>
                                                    <div class="body-title-2">Log out</div>
                                                </a>
                                            </li>
                                        </ul>
                                    </div>
                                </div>
                            </div>
                        </div>
                    </div>
                    <!-- /header-dashboard -->
                    <!-- main-content -->
                    <div class="main-content">
                        <!-- main-content-wrap -->
                        <div class="main-content-inner">
                            <!-- main-content-wrap -->
                            <div class="main-content-wrap">
                                <div class="flex items-center flex-wrap justify-between gap20 mb-30">
                                    <h3>Product Management</h3>
                                    <ul class="breadcrumbs flex items-center flex-wrap justify-start gap10">
                                        <li>
                                            <a href="/admin/dashboard">
                                                <div class="text-tiny">Dashboard</div>
                                            </a>
                                        </li>
                                        <li>
                                            <i class="icon-chevron-right"></i>
                                        </li>
                                        <li>
                                            <a href="#">
                                                <div class="text-tiny">Products</div>
                                            </a>
                                        </li>
                                        <li>
                                            <i class="icon-chevron-right"></i>
                                        </li>
                                        <li>
                                            <div class="text-tiny">Product Management</div>
                                        </li>
                                    </ul>
                                </div>
                                
                                <% 
                                // Helper functions
                                const getPopulatedName = (field) => {
                                    return field && (field.title || field.name) ? (field.title || field.name) : (field || "N/A");
                                };
                                const getCategoryName = (product) => {
                                    if (product.childCategory) return getPopulatedName(product.childCategory);
                                    if (product.subCategory) return getPopulatedName(product.subCategory);
                                    if (product.category) return getPopulatedName(product.category);
                                    return "Uncategorized";
                                };
                                const getQueryUrl = (newParams) => {
                                    const currentQuery = new URLSearchParams(query);
                                    for (const [key, val] of Object.entries(newParams)) {
                                        if (val === null || val === undefined || val === '') currentQuery.delete(key);
                                        else currentQuery.set(key, val);
                                    }
                                    return `/admin/products?${currentQuery.toString()}`;
                                };
                                const getSeoKeywords = (seo) => {
                                    if (seo && Array.isArray(seo.keywords) && seo.keywords.length) {
                                        return seo.keywords.join(", ");
                                    }
                                    return "N/A";
                                };
                                // Product Status Badge Styling
                                const statusColors = {
                                    Active: "linear-gradient(90deg, #44C997 34%, #2E9FFF 100%)",
                                    Inactive: "linear-gradient(90deg, #e96d6d 34%, #a43931 100%)",
                                    Pending: "linear-gradient(90deg, #FFD96E 34%, #FDA63E 100%)"
                                };
                                %>

                                <div class="wg-box stylish-product-list">
                                    <div class="title-box">
                                        <i class="icon-shopping-bag"></i>
                                        <div class="body-text fancy-note">
                                            <span class="shake">✨</span> Manage your product catalog in style! Effortlessly find, update, and keep track of every detail at a glance. <span class="shake">✨</span>
                                        </div>
                                    </div>
                                    <div class="flex items-center justify-between gap12 flex-wrap mb-4">
                                        <!-- Filters Dropdown Button -->
                                        <div class="wg-filter flex-grow">
                                            <div class="filter-menu-wrapper" style="position:relative;display:inline-block;">
                                                <button type="button" class="tf-button tf-button-sm stylish-main-btn" id="filter-menu-btn" style="display:flex;align-items:center;gap:3px;">
                                                    <i class="icon-menu"></i>
                                                    Filters
                                                </button>
                                                <div id="filter-menu-dropdown" style="display:none; position:absolute; z-index:50; top:110%; left:0; min-width:340px; background:#fff; box-shadow:0 3px 24px 5px rgba(0,0,0,0.08); border-radius:12px; padding:22px 24px 16px 20px;">
                                                    <form id="product-filter-form" class="fancy-filter-form" action="/admin/products" method="GET">
                                                        <div class="filter-row" style="display:flex; flex-direction:column; gap:16px;">
                                                            <!-- Limit/Show entries -->
                                                            <div class="show stylish-show" style="display:flex; align-items:center;">
                                                                <span class="text-tiny">Show</span>
                                                                <div class="select" style="margin:0 8px;">
                                                                    <select id="limit-select" name="limit"
                                                                        onchange="this.form.submit()"
                                                                        style="min-width:64px;">
                                                                        <option value="all" <%= !query.limit || query.limit == "all" ? 'selected' : '' %>>All</option>
                                                                        <option value="10" <%= query.limit==10 ? 'selected' : '' %>>10</option>
                                                                        <option value="20" <%= query.limit==20 ? 'selected' : '' %>>20</option>
                                                                        <option value="30" <%= query.limit==30 ? 'selected' : '' %>>30</option>
                                                                    </select>
                                                                </div>
                                                                <span class="text-tiny">entries</span>
                                                            </div>
                                                            <!-- Category -->
                                                            <div class="select filter-select">
                                                                <select name="category" onchange="this.form.submit()">
                                                                    <option value="all" <%= (!query.category || query.category == "all") ? 'selected' : '' %>>All Categories</option>
                                                                    <% categories.forEach(function(cat){ %>
                                                                        <option value="<%= cat._id %>" <%= query.category == cat._id ? 'selected' : '' %>><%= cat.name %></option>
                                                                    <% }) %>
                                                                </select>
                                                            </div>
                                                            <!-- SubCategory -->
                                                            <div class="select filter-select">
                                                                <select name="subCategory" onchange="this.form.submit()">
                                                                    <option value="all" <%= (!query.subCategory || query.subCategory == "all") ? 'selected' : '' %>>All Subcategories</option>
                                                                    <% subcategories.forEach(function(subcat){ %>
                                                                        <option value="<%= subcat._id %>" <%= query.subCategory == subcat._id ? 'selected' : '' %>><%= subcat.name %></option>
                                                                    <% }) %>
                                                                </select>
                                                            </div>
                                                            <!-- ChildCategory -->
                                                            <div class="select filter-select">
                                                                <select name="childCategory" onchange="this.form.submit()">
                                                                    <option value="all" <%= (!query.childCategory || query.childCategory == "all") ? 'selected' : '' %>>All Child Categories</option>
                                                                    <% childcategories.forEach(function(childcat){ %>
                                                                        <option value="<%= childcat._id %>" <%= query.childCategory == childcat._id ? 'selected' : '' %>><%= childcat.name %></option>
                                                                    <% }) %>
                                                                </select>
                                                            </div>
                                                            <!-- Product Type -->
                                                            <div class="select filter-select">
                                                                <select name="productType" onchange="this.form.submit()">
                                                                    <option value="all" <%= (!query.productType || query.productType == "all") ? 'selected' : '' %>>All Product Types</option>
                                                                    <option value="admin" <%= query.productType == 'admin' ? 'selected' : '' %>>Admin</option>
                                                                    <option value="salon" <%= query.productType == 'salon' ? 'selected' : '' %>>Salon</option>
                                                                    <option value="reseller" <%= query.productType == 'reseller' ? 'selected' : '' %>>Reseller</option>
                                                                </select>
                                                            </div>
                                                            <!-- Status -->
                                                            <div class="select filter-select">
                                                                <select name="status" onchange="this.form.submit()">
                                                                    <option value="all" <%= (!query.status || query.status == "all") ? 'selected' : '' %>>All Statuses</option>
                                                                    <option value="draft" <%= query.status == 'draft' ? 'selected' : '' %>>Draft</option>
                                                                    <option value="pending" <%= query.status == 'pending' ? 'selected' : '' %>>Pending</option>
                                                                    <option value="approved" <%= query.status == 'approved' ? 'selected' : '' %>>Approved</option>
                                                                    <option value="rejected" <%= query.status == 'rejected' ? 'selected' : '' %>>Rejected</option>
                                                                    <option value="disabled" <%= query.status == 'disabled' ? 'selected' : '' %>>Disabled</option>
                                                                </select>
                                                            </div>
                                                            <!-- Brand (text) -->
                                                            <input type="text" class="input filter-input" name="brand" placeholder="Brand" style="min-width:90px; width:100%; max-width:200px;" value="<%= query.brand ? query.brand : '' %>" autocomplete="off" onkeydown="if(event.key==='Enter'){this.form.submit();}">
                                                            <!-- Filter/Reset -->
                                                            <div style="display:flex; gap:10px; margin-top:12px;">
                                                                <button type="submit" class="tf-button tf-button-sm" style="height:32px;min-width:90px;">Filter</button>
                                                                <a href="/admin/products" class="tf-button tf-button-ghost tf-button-sm" style="height:32px;">Reset</a>
                                                            </div>
                                                        </div>
                                                    </form>
                                                </div>
                                            </div>
                                            <!-- Inline Search Always Visible -->
                                            <div class="form-search fancy-search" style="margin-left:15px; min-width:160px; display:inline-block;">
                                                <form action="/admin/products" method="GET" style="display:flex;gap:0;">
                                                    <input type="text" id="search-input" name="search"
                                                        placeholder="🔍 Search by title, brand, tags, SKU..."
                                                        value="<%= query.search || '' %>"
                                                        style="width:150px; max-width:200px;">
                                                    <button type="submit" id="search-btn"><i class="icon-search"></i></button>
                                                    <% // when other filters exist, keep them with search %>
                                                    <% Object.keys(query).forEach(function(key){ if(key!=="search" && query[key]) { %>
                                                        <input type="hidden" name="<%= key %>" value="<%= query[key] %>">
                                                    <% } }); %>
                                                </form>
                                            </div>
                                        </div>
                                        <a class="tf-button stylish-main-btn" href="#" id="add-product-btn">
                                            <i class="icon-plus"></i> Add Product
                                        </a>
                                    </div>
                                    <style>
                                    /* Responsive Filters Dropdown */
                                    @media (max-width: 900px) {
                                        #filter-menu-dropdown {
                                            min-width: 210px;
                                            max-width: 98vw;
                                            left: 0;
                                            right: 0;
                                        }
                                    }
                                    @media (max-width: 600px) {
                                        .flex.items-center.justify-between.gap12.flex-wrap.mb-4 {
                                            flex-direction: column;
                                            align-items: stretch;
                                            gap: 12px;
                                        }
                                        #filter-menu-dropdown form .filter-row {
                                            flex-direction: column;
                                            gap: 10px;
                                            width: 100%;
                                        }
                                        #filter-menu-dropdown input, 
                                        #filter-menu-dropdown select {
                                            min-width: 0!important;
                                            width:100%!important;
                                            max-width:100%!important;
                                        }
                                    }
                                    </style>
                                    <script>
                                    // Toggle filter dropdown
                                    (function() {
                                        var btn = document.getElementById('filter-menu-btn');
                                        var dropdown = document.getElementById('filter-menu-dropdown');
                                        if(btn && dropdown) {
                                            btn.onclick = function(e) {
                                                e.stopPropagation();
                                                dropdown.style.display = (dropdown.style.display === "none" || dropdown.style.display === "") ? "block" : "none";
                                            };
                                            document.body.addEventListener('click', function() {
                                                dropdown.style.display = "none";
                                            });
                                            dropdown.onclick = function(e) { e.stopPropagation(); };
                                        }
                                    })();
                                    </script>
                                    <div class="products-container stylish-grid" id="products-list">
                                    <% if (products && products.length > 0) { %>
                                      <% products.forEach(function(product) { %>
                                        <div class="product-card stylish-card" data-product-id="<%= product._id %>">
                                            <div class="stylish-card-header">
                                                <div class="product-status-avatar">
                                                    <div class="product-image-glow">
                                                        <img src="<%= (product.images && product.images.length > 0) ? product.images[0] : '/images/default-product.jpg' %>"
                                                            alt="<%= product.title %> image">
                                                    </div>
                                                    <span
                                                        class="status-badge big-badge"
                                                        data-status="<%= product.status %>"
                                                        style='background: <%= statusColors[product.status ? (product.status.charAt(0).toUpperCase() + product.status.slice(1)) : "Inactive"] || "#e0e0e0" %>; color: #fff;'
                                                    >
                                                        <%= product.status ? (product.status.charAt(0).toUpperCase() + product.status.slice(1)) : 'N/A' %>
                                                    </span>
                                                </div>
                                                <div class="stylish-header-main">
                                                    <h2 class="product-title stylish-title"><%= product.title %></h2>
                                                    <div class="subtitle-spark">Slug: <span class="sku-key"><%= product.slug || "N/A" %></span></div>
                                                    <div class="subtitle-spark">SKU: <span class="sku-key"><%= product.sku || "N/A" %></span></div>
                                                    <div class="category-pill">
                                                        <i class="icon-layers"></i>
                                                        <%= product.category && product.category.name ? product.category.name : (product.category ? product.category : "N/A") %>
                                                        <% if (product.subCategory) { %>
                                                            <span> / </span>
                                                            <%= product.subCategory && product.subCategory.name ? product.subCategory.name : product.subCategory %>
                                                        <% } %>
                                                        <% if (product.childCategory) { %>
                                                            <span> / </span>
                                                            <%= product.childCategory && product.childCategory.name ? product.childCategory.name : product.childCategory %>
                                                        <% } %>
                                                    </div>
                                                </div>
                                                <button class="status-toggle-btn"
                                                    data-product-id="<%= product._id %>"
                                                    data-current-status="<%= product.status %>"
                                                    title="Toggle Status"
                                                >
                                                    <i class="icon-refresh-cw"></i> 
                                                    Update Status
                                                </button>
                                            </div>
                                            <div class="stylish-details-body">
                                                <div class="details-table">
                                                    <div class="half-width-list">
                                                        <ul>
                                                            <li><strong>Brand:</strong> <%= product.brand || 'N/A' %></li>
                                                            <li><strong>Product Type:</strong> <%= product.productType || 'N/A' %></li>
                                                            <li><strong>Owner Ref:</strong>
                                                                <% if (product.ownerRef) { %>
                                                                    <% if (typeof product.ownerRef === "object") { %>
                                                                        <%= product.ownerRef._id || JSON.stringify(product.ownerRef) %>
                                                                        <% if (product.ownerRef.name) { %>
                                                                            (<%= product.ownerRef.name %>)
                                                                        <% } %>
                                                                    <% } else { %>
                                                                        <%= product.ownerRef %>
                                                                    <% } %>
                                                                <% } else { %>
                                                                    N/A
                                                                <% } %>
                                                            </li>
                                                            <li><strong>Base Price:</strong> <span class="green-price">₹<%= product.basePrice !== undefined ? Number(product.basePrice).toFixed(2) : 'N/A' %></span></li>
                                                            <li><strong>Sale Price:</strong> <span class="red-price">₹<%= product.salePrice !== undefined ? Number(product.salePrice).toFixed(2) : 'N/A' %></span></li>
                                                            <li><strong>Admin Base Price:</strong> <span class="green-price">₹<%= product.adminBasePrice !== undefined ? Number(product.adminBasePrice).toFixed(2) : 'N/A' %></span></li>
                                                            <li><strong>Admin Sale Price:</strong> <span class="red-price">₹<%= product.adminSalePrice !== undefined ? Number(product.adminSalePrice).toFixed(2) : 'N/A' %></span></li>
                                                            <li><strong>Total Stock:</strong> <%= product.totalStock || 0 %></li>
                                                            <li><strong>Variants:</strong> <%= (product.variants && product.variants.length > 0) ? product.variants.length : 'None' %></li>
                                                            <li><strong>Main Images:</strong> <%= (product.images && product.images.length) ? product.images.length : '0' %></li>
                                                        </ul>
                                                    </div>
                                                    <div class="half-width-list">
                                                        <ul>
                                                            <li><strong>Short Description:</strong> <span><%= product.shortDescription || 'N/A' %></span></li>
                                                            <li><strong>Description:</strong> <span><%= product.description || 'N/A' %></span></li>
                                                            <li><strong>Tags:</strong> <span class="tags-list"><%= (product.tags && product.tags.length > 0) ? product.tags.join(", ") : "N/A" %></span></li>
                                                            <li><strong>Ingredients:</strong> <span><%= (product.ingredients && product.ingredients.length > 0) ? product.ingredients.join(", ") : "N/A" %></span></li>
                                                            <li><strong>Benefits:</strong> <span><%= (product.benefits && product.benefits.length > 0) ? product.benefits.join("; ") : "N/A" %></span></li>
                                                            <li><strong>How To Use:</strong> <span><%= product.howToUse || "N/A" %></span></li>
                                                            <li><strong>Total Sold:</strong> <%= product.totalSold || 0 %></li>
                                                            <li><strong>Weight:</strong> <%= product.weight ? product.weight + " kg" : "N/A" %></li>
                                                            <li>
                                                                <strong>Dimensions:</strong>
                                                                <% if (product.dimensions) { %>
                                                                    <%= product.dimensions.length !== undefined ? product.dimensions.length : 'N/A' %> /
                                                                    <%= product.dimensions.width !== undefined ? product.dimensions.width : 'N/A' %> /
                                                                    <%= product.dimensions.height !== undefined ? product.dimensions.height : 'N/A' %> cm
                                                                <% } else { %>
                                                                    N/A
                                                                <% } %>
                                                            </li>
                                                            <li>
                                                                <strong>Rating:</strong>
                                                                <span class="rating-star">
                                                                <i class="icon-star"></i>
                                                                <%= product.rating !== undefined ? Number(product.rating).toFixed(1) : 'N/A' %>
                                                                </span>
                                                                (<%= product.totalReviews || 0 %> reviews)
                                                            </li>
                                                        </ul>
                                                    </div>
                                                </div>
                                                <div class="stylish-badges-row">
                                                    <span class="badge badge-pill badge-benefits"><i class="icon-heart"></i> Benefits: <%= (product.benefits && product.benefits.length > 0) ? product.benefits.join("; ") : "N/A" %></span>
                                                    <span class="badge badge-pill badge-beauty"><i class="icon-sparkles"></i> Beauty Tips:
                                                        <%= (product.beautyTips && product.beautyTips.length > 0) ? product.beautyTips.length : 'None' %>
                                                    </span>
                                                </div>
                                            </div>
                                            <div class="stylish-sep"></div>
                                            <div class="stylish-meta-row">
                                                <div class="meta-block">
                                                    <strong>SEO Title:</strong>
                                                    <span><%= product.seo && product.seo.title ? product.seo.title : 'N/A' %></span>
                                                </div>
                                                <div class="meta-block">
                                                    <strong>SEO Description:</strong>
                                                    <span><%= product.seo && product.seo.description ? product.seo.description : 'N/A' %></span>
                                                </div>
                                                <div class="meta-block">
                                                    <strong>SEO Keywords:</strong>
                                                    <span>
                                                        <%= (product.seo && product.seo.keywords && product.seo.keywords.length) ? product.seo.keywords.join(", ") : "N/A" %>
                                                    </span>
                                                </div>
                                            </div>
                                            <div class="stylish-footer">
                                                <button class="details-btn" onclick="toggleDetails(this)">
                                                    View Full Details <i class="icon-chevron-down"></i>
                                                </button>
                                                <div class="card-actions-stylish">
                                                    <button class="item edit" title="Edit Product" data-product-id="<%= product._id %>">
                                                        <i class="icon-edit-3"></i>
                                                    </button>
                                                    <button class="item trash" title="Delete Product" data-product-id="<%= product._id %>">
                                                        <i class="icon-trash-2"></i>
                                                    </button>
                                                </div>
                                            </div>
                                            <div class="expanded-details stylish-expanded-details">
                                                <div class="detail-section">
                                                    <span class="section-title"><i class="icon-file-text"></i> Description</span>
                                                    <p class="stylish-description"><%= product.description || 'N/A' %></p>
                                                </div>
                                               
                                                <% if (product.variants && product.variants.length > 0) { %>
                                                <div class="detail-section">
                                                    <span class="section-title"><i class="icon-layers"></i> Variants & Options</span>
                                                    <div class="variant-table">
                                                        <% product.variants.forEach(function(variant){ %>
                                                            <div class="variant-block">
                                                                <strong>Variant: <%= variant.name %></strong>
                                                                <ul>
                                                                    <% (variant.options || []).forEach(function(opt){ %>
                                                                    <li>
                                                                        <span class="option-chip"><%= opt.value %></span>
                                                                        <span class="option-info">
                                                                            [Stock: <%= opt.stock %>,
                                                                            SKU: <%= opt.sku || 'N/A' %>,
                                                                            Price: <%= opt.price !== undefined ? ('₹' + opt.price) : 'N/A' %>,
                                                                            Admin Base: <%= opt.adminBasePrice !== undefined ? ('₹' + opt.adminBasePrice) : 'N/A' %>,
                                                                            Admin Sale: <%= opt.adminSalePrice !== undefined ? ('₹' + opt.adminSalePrice) : 'N/A' %>,
                                                                            Images: <%= (opt.images && opt.images.length) ? opt.images.length : '0' %>]
                                                                        </span>
                                                                    </li>
                                                                    <% }) %>
                                                                </ul>
                                                            </div>
                                                        <% }); %>
                                                    </div>
                                                </div>
                                                <% } %>
                                                <% if (product.beautyTips && product.beautyTips.length > 0) { %>
                                                <div class="detail-section">
                                                    <span class="section-title"><i class="icon-sparkles"></i> Linked Beauty Tips</span>
                                                    <ul class="fancyList">
                                                    <% product.beautyTips.forEach(function(tip){ %>
                                                        <li>
                                                        <% if (typeof tip === 'object' && tip !== null) { %>
                                                            <strong><%= tip.title || 'Untitled Beauty Tip' %></strong>
                                                            <% if (tip.shortDescription) { %>
                                                                <div class="beautyTip-short-desc"><%= tip.shortDescription %></div>
                                                            <% } %>
                                                            <% if (tip.category && typeof tip.category === 'object' && tip.category.name) { %>
                                                                <span class="badge badge-category"><i class="icon-tag"></i> <%= tip.category.name %></span>
                                                            <% } %>
                                                            <span class="text-xs text-muted">(<%= tip._id %>)</span>
                                                        <% } else { %>
                                                            <%= tip %>
                                                        <% } %>
                                                        </li>
                                                    <% }) %>
                                                    </ul>
                                                </div>
                                                <% } %>
                                            </div>
                                        </div>
                                      <% }) %>
                                    <% } else { %>
                                        <div class="text-center p-5">
                                            <h4>No Products Found</h4>
                                            <p>Try adjusting your filters or search term.</p>
                                        </div>
                                    <% } %>
                                    </div>
                                    <div class="divider"></div>
                                    <div class="flex items-center justify-between flex-wrap gap10 stylish-paging-row">
                                        <div class="text-tiny" id="showing-entries">
                                            Showing <%= (page - 1) * limit + 1 %> to <%= Math.min(page * limit, total) %> of <%= total %> entries
                                        </div>
                                        <ul class="wg-pagination" id="pagination">
                                            <% if (page > 1) { %>
                                            <li><a href="<%= getQueryUrl({page: page - 1}) %>">Previous</a></li>
                                            <% } %>
                                            <% 
                                            const startPage=Math.max(1, page-2); 
                                            const endPage=Math.min(totalPages, page+2);
                                            for(let i=startPage; i<=endPage; i++) { %>
                                                <li class="<%= i === page ? 'active' : '' %>">
                                                    <a href="<%= getQueryUrl({page: i}) %>"><%= i %></a>
                                                </li>
                                            <% } %>
                                            <% if (page < totalPages) { %>
                                            <li><a href="<%= getQueryUrl({page: page + 1}) %>">Next</a></li>
                                            <% } %>
                                        </ul>
                                    </div>
                                </div>
                                <script>
                                    document.addEventListener("DOMContentLoaded", function() {
                                        var limitSelect = document.getElementById('limit-select');
                                        if (limitSelect) limitSelect.value = <%= query.limit || 20 %>;
                                        // Add Product open modal event
                                        var addButton = document.getElementById('add-product-btn');
                                        if (addButton) {
                                            addButton.addEventListener('click', function(e) {
                                                e.preventDefault();
                                                var modal = document.getElementById('product-modal');
                                                if (modal) {
                                                    modal.style.display = 'block';
                                                    if (typeof initializeProductForm === 'function') initializeProductForm();
                                                }
                                            });
                                        }
                                        // Edit Product
                                        document.querySelectorAll('.product-card .item.edit').forEach(function(btn) {
                                            btn.addEventListener('click', function(e) {
                                                e.preventDefault();
                                                var id = this.getAttribute('data-product-id');
                                                fetch('/admin/products/product/' + encodeURIComponent(id))
                                                .then(res => res.ok ? res.json() : Promise.reject(res))
                                                .then(product => {
                                                    var modal = document.getElementById('product-modal');
                                                    if (modal) {
                                                        if (typeof openProductModal === "function") openProductModal('edit', product);
                                                        else modal.style.display = 'block';
                                                    }
                                                });
                                            });
                                        });
                                        // Delete Product
                                        document.querySelectorAll('.product-card .item.trash').forEach(function(btn) {
                                            btn.addEventListener('click', function(e) {
                                                e.preventDefault();
                                                var id = this.getAttribute('data-product-id');
                                                var modal = document.getElementById('confirm-delete-modal');
                                                if (modal) {
                                                    if (typeof openDeleteModal === 'function') openDeleteModal(id);
                                                    else modal.style.display = 'block';
                                                }
                                            });
                                        });
                                        // Toggle details
                                        document.querySelectorAll(".product-card .details-btn").forEach(function(btn) {
                                            btn.addEventListener("click", function(e) {
                                                var card = btn.closest(".product-card");
                                                if (!card) return;
                                                var details = card.querySelector(".expanded-details");
                                                if (details) {
                                                    details.classList.toggle("active");
                                                    btn.innerHTML = details.classList.contains("active")
                                                        ? 'Hide Details <i class="icon-chevron-up"></i>'
                                                        : 'View Full Details <i class="icon-chevron-down"></i>';
                                                }
                                            });
                                        });

                                        // Stylish Status Toggle button AJAX
                                        document.querySelectorAll('.status-toggle-btn').forEach(function(btn) {
                                            btn.addEventListener('click', function(e) {
                                                e.preventDefault();
                                                var productId = this.getAttribute('data-product-id');
                                                var currentBtn = this;
                                                currentBtn.disabled = true;
                                                currentBtn.innerHTML = `<span class="spinning"><i class="icon-loader"></i></span> Updating`;
                                                fetch(`/product/${encodeURIComponent(productId)}/toggle-status`, {
                                                    method: 'PATCH',
                                                    headers: {'Content-Type': 'application/json'}
                                                })
                                                .then(res => res.ok ? res.json() : Promise.reject(res))
                                                .then(data => {
                                                    // Update the status-badge styling and text in card header
                                                    var card = currentBtn.closest('.product-card');
                                                    if (card) {
                                                        var badge = card.querySelector('.status-badge');
                                                        if (badge && data.status) {
                                                            badge.textContent = data.status.charAt(0).toUpperCase() + data.status.slice(1);
                                                            // Update color background inline (for stylish badge)
                                                            let statusBG = {
                                                                Active: "linear-gradient(90deg, #44C997 34%, #2E9FFF 100%)",
                                                                Inactive: "linear-gradient(90deg, #e96d6d 34%, #a43931 100%)",
                                                                Pending: "linear-gradient(90deg, #FFD96E 34%, #FDA63E 100%)"
                                                            };
                                                            badge.style.background = statusBG[data.status.charAt(0).toUpperCase() + data.status.slice(1)] || "#e0e0e0";
                                                        }
                                                        badge.setAttribute('data-status', data.status);
                                                        // update the button current-status attribute
                                                        currentBtn.setAttribute('data-current-status', data.status);
                                                    }
                                                    currentBtn.disabled = false;
                                                    currentBtn.innerHTML = `<i class="icon-refresh-cw"></i> Update Status`;
                                                }).catch(()=>{
                                                    currentBtn.innerHTML = '<i class="icon-refresh-cw"></i> Retry';
                                                    currentBtn.disabled = false;
                                                });
                                            });
                                        });
                                    });
                                </script>

                                <!-- Inline Styles for Stylish Display (These can be moved to your CSS file!) -->
                                <style>
                                    .stylish-product-list { background: #fff; border-radius: 14px; box-shadow: 0 3px 16px #e9eaee; padding: 30px 24px 20px;}
                                    .title-box .fancy-note { font-size: 1.08rem; color: #3e70e5; font-weight: 500; letter-spacing: 0.02em;}
                                    .fancy-note .shake { animation: shake .6s infinite alternate;}
                                    @keyframes shake { to { transform: rotate(-7deg);} }
                                    .stylish-grid { display: grid; grid-template-columns: repeat(auto-fit, minmax(390px, 1fr)); gap: 28px;}
                                    .product-card.stylish-card { position: relative; box-shadow: 0 2px 12px #f3f4fd; border-radius: 14px; background: #f6f9ff; pad: 0 0 0 0; overflow: hidden; transition: box-shadow .18s;}
                                    .product-card.stylish-card:hover { box-shadow: 0 5px 32px #dbedfa;}
                                    .stylish-card-header { display: flex; gap: 1.3em; align-items: center; padding: 18px 22px 10px 16px; position: relative; }
                                    .product-status-avatar { position: relative; }
                                    .product-image-glow img { border-radius: 9px; width: 73px; height: 73px; object-fit: cover; box-shadow: 0 2px 13px #cfdeed;}
                                    .status-badge.big-badge { font-weight: bold; font-size: 0.99em; position: absolute; bottom: 0; right: 0; padding: 3px 13px; border-radius: 13px; box-shadow: 0 2px 9px #ece9e9; border: none;}
                                    .stylish-header-main { flex: 1; }
                                    .stylish-title { margin: 0 0 2px 0; font-size: 1.28em; font-weight: 700; letter-spacing: .02em; color: #185886;}
                                    .subtitle-spark { font-size: 0.97em; color: #89a5c0; font-weight: 500;}
                                    .sku-key { background: #223f6022; color: #287bb9; border-radius: 7px; padding: 2px 8px; font-size: 92%; }
                                    .category-pill { background: #e9f5fa; border-radius: 6px; margin-top: 2px; display: inline-block; font-size: 89%; color: #0d406d; padding: 2px 9px 2px 5px;}
                                    .status-toggle-btn { border: none; background: #eef7ff; color: #15677e; font-weight: bold; padding: 7px 16px; border-radius: 9px; cursor: pointer; margin-left: 12px; transition: background .17s; font-size: 0.96em;}
                                    .status-toggle-btn:active, .status-toggle-btn:focus { outline: none; background: #e0ebfc;}
                                    .status-toggle-btn .icon-refresh-cw { margin-right: .38em;}
                                    .status-toggle-btn[disabled] { opacity: 0.68;}
                                    .stylish-details-body { padding: 9px 18px 3px 22px;}
                                    .details-table { display: flex; gap: 1em; margin-bottom: 10px;}
                                    .half-width-list {flex:1;}
                                    .half-width-list ul {list-style: none; padding: 0; margin: 0;}
                                    .half-width-list li {padding: 2px 0; font-size: 100%; color: #3c4a5a;}
                                    .green-price { color: #40bb6d; font-weight: bold;}
                                    .red-price { color: #e96d6d; font-weight: bold;}
                                    .tags-list { background: #d9f0fb; padding: 1px 7px 1px 6px; border-radius: 5px;}
                                    .rating-star { color: #f1b719; font-weight: bold;}
                                    .badge { padding: 4px 12px; border-radius: 7px; margin-right: 9px; font-size: .98em; }
                                    .badge-benefits { background: #e9ffef; color: #36a86f;}
                                    .badge-beauty { background: #ffe9fa; color: #db409c;}
                                    .stylish-badges-row {margin: 7px 0 4px 0;}
                                    .stylish-sep {height: 1px; background: #e8e8f1; margin: 12px 0 10px;}
                                    .stylish-meta-row { display: flex; gap: 1.5em; justify-content: start; padding: 2px 18px 0 22px;}
                                    .meta-block { font-size: 0.97em; color: #6e708b;}
                                    .stylish-footer { display: flex; justify-content: space-between; align-items: center; padding: 11px 21px 12px 19px; }
                                    .card-actions-stylish button { margin-left: 7px; background: #f7f7fb; border: none; border-radius: 6px; padding: 5px 11px; color: #2082c1; cursor: pointer; }
                                    .card-actions-stylish button:active, .card-actions-stylish button:focus { background: #ecf1f9;}
                                    .details-btn { background: #3a8ef6; color: #fff; border-radius: 9px; border: none; padding: 7px 17px; font-weight: 600; cursor: pointer; box-shadow: 0 1px 9px #cbeafe4e; transition: background .15s;}
                                    .details-btn:active, .details-btn:focus { background: #185886;}
                                    .expanded-details.stylish-expanded-details {display: none; background: #eef7ff; padding: 16px 30px 13px 28px; border-top: 1px solid #d1e5ef; }
                                    .product-card .expanded-details.active { display: block;}
                                    .detail-section {margin-bottom: 13px;}
                                    .section-title {color: #2a89c9; font-size: 1.07em; font-weight: 500; display: flex; align-items: center; gap: .7em;}
                                    .fancyList { margin: 0 0 0 1em;}
                                    .option-chip { background: #b7dfed; color: #03697e; border-radius: 4px; padding: 1px 8px; font-size: .96em; margin-right: 8px; }
                                    .option-info {font-size: .96em; color: #768394;}
                                    .variant-block {margin-bottom:10px;}
                                    .stylish-description {margin: 0; font-size: 1.02em;}
                                    .stylish-main-btn {background: linear-gradient(98deg, #29b6f6 0%, #75d3ff 91%); color: #fff; box-shadow: 0 2px 10px #dbf3fa;}
                                    .stylish-main-btn:hover {background: linear-gradient(98deg, #1488cc 0, #29b6f6 92%);}
                                    .stylish-paging-row {margin-top: 17px;}
                                    .spinning {animation: spin 900ms linear infinite;}
                                    @keyframes spin {100%{transform:rotate(360deg);}}
                                </style>


                               
                        
                                    <!-- ADD & EDIT PRODUCT MODAL -->
                                    <div id="product-modal" class="modal" style="display:none;">
                                        <div class="modal-content modern-modal large-modal">
                                            <div class="modal-header">
                                                <div class="modal-title">
                                                    <i class="icon-edit"></i>
                                                    <h3 id="product-modal-title">Add New Product</h3>
                                                </div>
                                                <button type="button" class="close-btn" onclick="closeModal('product-modal')">
                                                    <i class="icon-x"></i>
                                                </button>
                                            </div>
                                            <div class="modal-body">
                                                <form id="product-form" enctype="multipart/form-data" autocomplete="off">
                                                    <input type="hidden" name="editId" id="edit-id">
                                                    <!-- BASIC INFORMATION -->
                                                    <div class="form-section">
                                                        <div class="section-header">
                                                            <h4><i class="icon-info"></i> Basic Information</h4>
                                                        </div>
                                                        <div class="form-grid">
                                                            <div class="form-group">
                                                                <label for="product-title">Product Title *</label>
                                                                <input type="text" id="product-title" name="title" required placeholder="Enter product title" value="">
                                                            </div>
                                                            <div class="form-group">
                                                                <label for="product-slug">Slug</label>
                                                                <input type="text" id="product-slug" name="slug" placeholder="auto-generated-slug" value="">
                                                                <small class="form-help">Leave empty for auto-generation</small>
                                                            </div>
                                                        </div>
                                                        <div class="form-group">
                                                            <label for="product-shortDescription">Short Description</label>
                                                            <textarea id="product-shortDescription" name="shortDescription" rows="2" placeholder="Brief product summary"></textarea>
                                                        </div>
                                                        <div class="form-group">
                                                            <label for="product-description">Full Description</label>
                                                            <textarea id="product-description" name="description" rows="4" placeholder="Detailed product description"></textarea>
                                                        </div>
                                                    </div>

                                                    <!-- CATEGORY SELECTION -->
                                                    <div class="form-section">
                                                        <div class="section-header">
                                                            <h4><i class="icon-layers"></i> Category</h4>
                                                        </div>
                                                        <div class="form-grid">
                                                            <div class="form-group">
                                                                <label for="product-category">Main Category</label>
                                                                <select id="product-category" name="category" class="category-select">
                                                                    <option value="">Select Category</option>
                                                                    <% categories.forEach(cat=> { %>
                                                                        <option value="<%= cat._id %>"><%= cat.name %></option>
                                                                    <% }) %>
                                                                </select>
                                                            </div>
                                                            <div class="form-group">
                                                                <label for="product-subCategory">Subcategory</label>
                                                                <select id="product-subCategory" name="subCategory" class="category-select">
                                                                    <option value="">Select Subcategory</option>
                                                                    <% subcategories.forEach(sub=> { %>
                                                                        <option value="<%= sub._id %>" data-categoryid="<%= sub.categoryId %>"><%= sub.name %></option>
                                                                    <% }) %>
                                                                </select>
                                                            </div>
                                                            <div class="form-group">
                                                                <label for="product-childCategory">Child Category</label>
                                                                <select id="product-childCategory" name="childCategory" class="category-select">
                                                                    <option value="">Select Child Category</option>
                                                                    <% childcategories.forEach(child=> { %>
                                                                        <option value="<%= child._id %>" 
                                                                                data-categoryid="<%= child.categoryId %>" 
                                                                                data-subcategoryid="<%= child.subCategoryId %>">
                                                                            <%= child.name %>
                                                                        </option>
                                                                    <% }) %>
                                                                </select>
                                                            </div>
                                                        </div>
                                                    </div>

                                                    <!-- BEAUTY TIPS - MULTI SELECT -->
                                                    <div class="form-section">
                                                        <div class="section-header">
                                                            <h4><i class="icon-lightbulb"></i> Beauty Tips</h4>
                                                        </div>
                                                        <div class="form-group">
                                                            <label>Select Beauty Tips</label>
                                                            <div class="multi-select-container">
                                                                <div class="selected-items-display" id="beauty-tips-display">
                                                                    <span class="placeholder">No beauty tips selected</span>
                                                                </div>
                                                                <button type="button" class="select-trigger-btn" onclick="toggleBeautyTipsDropdown()">
                                                                    <i class="icon-chevron-down"></i> Select Beauty Tips
                                                                </button>
                                                                <div class="dropdown-options" id="beauty-tips-dropdown">
                                                                    <div class="dropdown-search">
                                                                        <input type="text" placeholder="Search beauty tips..." id="beauty-tips-search">
                                                                    </div>
                                                                    <div class="options-list">
                                                                        <div class="no-options">Loading beauty tips...</div>
                                                                    </div>
                                                                    <div class="dropdown-actions">
                                                                        <button type="button" class="btn btn-sm" onclick="selectAllBeautyTips()">Select All</button>
                                                                        <button type="button" class="btn btn-sm" onclick="clearBeautyTips()">Clear All</button>
                                                                    </div>
                                                                </div>
                                                            </div>
                                                            <input type="hidden" name="beautyTips" id="beauty-tips-input">
                                                        </div>
                                                    </div>

                                                    <!-- BRAND & PRODUCT TYPE -->
                                                    <div class="form-section">
                                                        <div class="section-header">
                                                            <h4><i class="icon-aperture"></i> Brand & Ownership</h4>
                                                        </div>
                                                        <div class="form-grid">
                                                            <div class="form-group">
                                                                <label for="product-brand">Brand Name</label>
                                                                <input type="text" id="product-brand" name="brand" placeholder="Enter brand name" value="">
                                                            </div>
                                                            <div class="form-group">
                                                                <label for="product-productType">Product Type *</label>
                                                                <select id="product-productType" name="productType" required>
                                                                    <option value="admin">Admin</option>
                                                                    <option value="salon">Salon</option>
                                                                    <option value="reseller">Reseller</option>
                                                                </select>
                                                            </div>
                                                            <div class="form-group">
                                                                <label for="product-ownerRef">Owner Reference ID</label>
                                                                <input type="text" id="product-ownerRef" name="ownerRef" placeholder="Owner MongoDB ID" value="">
                                                                <small class="form-help">Required if product type is salon or reseller</small>
                                                            </div>
                                                        </div>
                                                    </div>

                                                    <!-- PRICING -->
                                                    <div class="form-section">
                                                        <div class="section-header">
                                                            <h4><i class="icon-dollar-sign"></i> Pricing</h4>
                                                        </div>
                                                        <div class="form-grid">
                                                            <div class="form-group">
                                                                <label for="product-basePrice">Base Price (₹) *</label>
                                                                <input type="number" id="product-basePrice" name="basePrice" min="0" step="0.01" required placeholder="0.00" value="">
                                                            </div>
                                                            <div class="form-group">
                                                                <label for="product-salePrice">Sale Price (₹)</label>
                                                                <input type="number" id="product-salePrice" name="salePrice" min="0" step="0.01" placeholder="0.00" value="">
                                                            </div>
                                                            <div class="form-group">
                                                                <label for="product-adminBasePrice">Admin Base Price (₹)</label>
                                                                <input type="number" id="product-adminBasePrice" name="adminBasePrice" min="0" step="0.01" placeholder="0.00" value="">
                                                            </div>
                                                            <div class="form-group">
                                                                <label for="product-adminSalePrice">Admin Sale Price (₹)</label>
                                                                <input type="number" id="product-adminSalePrice" name="adminSalePrice" min="0" step="0.01" placeholder="0.00" value="">
                                                            </div>
                                                        </div>
                                                    </div>

                                                    <!-- INVENTORY -->
                                                    <div class="form-section">
                                                        <div class="section-header">
                                                            <h4><i class="icon-package"></i> Inventory</h4>
                                                        </div>
                                                        <div class="form-group">
                                                            <label for="product-totalStock">Total Stock *</label>
                                                            <input type="number" id="product-totalStock" name="totalStock" min="0" required value="">
                                                            <small class="form-help">This will be ignored if variants are added</small>
                                                        </div>
                                                    </div>

                                                    <!-- VARIANTS -->
                                                    <div class="form-section">
                                                        <div class="section-header">
                                                            <h4><i class="icon-sliders"></i> Product Variants</h4>
                                                            <button type="button" class="btn btn-sm btn-outline" onclick="addVariantSection()">
                                                                <i class="icon-plus"></i> Add Variant Type
                                                            </button>
                                                        </div>
                                                        <div id="variants-container">
                                                            <div class="no-variants-message">
                                                                <i class="icon-info"></i>
                                                                <p>No variants added. Add variant types like Color, Size, etc.</p>
                                                            </div>
                                                        </div>
                                                    </div>

                                                    <!-- PRODUCT IMAGES -->
                                                    <div class="form-section">
                                                        <div class="section-header">
                                                            <h4><i class="icon-image"></i> Product Images</h4>
                                                        </div>
                                                        <div class="form-group">
                                                            <label for="product-images">Upload Product Images *</label>
                                                            <div class="file-upload-area" id="product-file-upload-area">
                                                                <div class="upload-content">
                                                                    <i class="icon-upload"></i>
                                                                    <p>Drag & drop images here or click to browse</p>
                                                                    <span class="file-types">JPG, PNG, WEBP (Max 5MB each)</span>
                                                                </div>
                                                                <input type="file" id="product-images" name="images" multiple accept="image/*" >
                                                            </div>
                                                            <div class="image-preview-grid" id="product-image-preview-grid"></div>
                                                        </div>
                                                    </div>

                                                    <!-- PRODUCT PROPERTIES -->
                                                    <div class="form-section">
                                                        <div class="section-header">
                                                            <h4><i class="icon-grid"></i> Product Properties</h4>
                                                        </div>
                                                        <div class="form-group">
                                                            <label>Product Tags</label>
                                                            <div class="addable-list-container">
                                                                <div class="input-with-button">
                                                                    <input type="text" id="new-tag-input" placeholder="Enter a tag">
                                                                    <button type="button" class="add-item-btn" onclick="addTag()">
                                                                        <i class="icon-plus"></i> Add
                                                                    </button>
                                                                </div>
                                                                <div class="items-list" id="tags-list"></div>
                                                            </div>
                                                            <input type="hidden" name="tags" id="tags-input">
                                                        </div>
                                                        <div class="form-group">
                                                            <label>Ingredients</label>
                                                            <div class="addable-list-container">
                                                                <div class="input-with-button">
                                                                    <input type="text" id="new-ingredient-input" placeholder="Enter an ingredient">
                                                                    <button type="button" class="add-item-btn" onclick="addIngredient()">
                                                                        <i class="icon-plus"></i> Add
                                                                    </button>
                                                                </div>
                                                                <div class="items-list" id="ingredients-list"></div>
                                                            </div>
                                                            <input type="hidden" name="ingredients" id="ingredients-input">
                                                        </div>
                                                        <div class="form-group">
                                                            <label for="product-howToUse">How To Use</label>
                                                            <textarea id="product-howToUse" name="howToUse" rows="3" placeholder="Instructions for using the product"></textarea>
                                                        </div>
                                                        <div class="form-group">
                                                            <label>Benefits</label>
                                                            <div class="addable-list-container">
                                                                <div class="input-with-button">
                                                                    <input type="text" id="new-benefit-input" placeholder="Enter a benefit">
                                                                    <button type="button" class="add-item-btn" onclick="addBenefit()">
                                                                        <i class="icon-plus"></i> Add
                                                                    </button>
                                                                </div>
                                                                <div class="items-list" id="benefits-list"></div>
                                                            </div>
                                                            <input type="hidden" name="benefits" id="benefits-input">
                                                        </div>
                                                    </div>

                                                    <!-- SHIPPING & DIMENSIONS -->
                                                    <div class="form-section">
                                                        <div class="section-header">
                                                            <h4><i class="icon-truck"></i> Shipping & Dimensions</h4>
                                                        </div>
                                                        <div class="form-grid">
                                                            <div class="form-group">
                                                                <label for="product-weight">Weight (grams)</label>
                                                                <input type="number" id="product-weight" name="weight" min="0" step="0.1" placeholder="0.0" value="">
                                                            </div>
                                                            <div class="form-group">
                                                                <label>Dimensions (cm)</label>
                                                                <div class="dimensions-grid">
                                                                    <div class="dimension-input">
                                                                        <input type="number" id="product-length" name="dimensions[length]" min="0" step="0.1" placeholder="Length" value="">
                                                                        <label>Length</label>
                                                                    </div>
                                                                    <div class="dimension-input">
                                                                        <input type="number" id="product-width" name="dimensions[width]" min="0" step="0.1" placeholder="Width" value="">
                                                                        <label>Width</label>
                                                                    </div>
                                                                    <div class="dimension-input">
                                                                        <input type="number" id="product-height" name="dimensions[height]" min="0" step="0.1" placeholder="Height" value="">
                                                                        <label>Height</label>
                                                                    </div>
                                                                </div>
                                                            </div>
                                                        </div>
                                                    </div>

                                                    <!-- RATINGS & REVIEWS -->
                                                    <div class="form-section">
                                                        <div class="section-header">
                                                            <h4><i class="icon-star"></i> Ratings & Reviews</h4>
                                                        </div>
                                                        <div class="form-grid">
                                                            <div class="form-group">
                                                                <label for="product-rating">Initial Rating</label>
                                                                <input type="number" id="product-rating" name="rating" min="0" max="5" step="0.1" placeholder="0.0" value="">
                                                                <small class="form-help">0.0 to 5.0</small>
                                                            </div>
                                                            <div class="form-group">
                                                                <label for="product-totalReviews">Total Reviews</label>
                                                                <input type="number" id="product-totalReviews" name="totalReviews" min="0" value="">
                                                            </div>
                                                        </div>
                                                    </div>

                                                    <!-- STATUS -->
                                                    <div class="form-section">
                                                        <div class="section-header">
                                                            <h4><i class="icon-settings"></i> Status</h4>
                                                        </div>
                                                        <div class="form-grid">
                                                            <div class="form-group">
                                                                <label for="product-status">Product Status *</label>
                                                                <select id="product-status" name="status" required>
                                                                    <option value="draft">Draft</option>
                                                                    <option value="pending">Pending</option>
                                                                    <option value="approved">Approved</option>
                                                                    <option value="rejected">Rejected</option>
                                                                    <option value="disabled">Disabled</option>
                                                                </select>
                                                            </div>
                                                            <div class="form-group">
                                                                <label for="product-totalSold">Total Sold</label>
                                                                <input type="number" id="product-totalSold" name="totalSold" min="0" value="">
                                                            </div>
                                                        </div>
                                                    </div>

                                                    <!-- SEO -->
                                                    <div class="form-section">
                                                        <div class="section-header">
                                                            <h4><i class="icon-trending-up"></i> SEO Settings</h4>
                                                        </div>
                                                        <div class="form-group">
                                                            <label for="product-seo-title">SEO Title</label>
                                                            <input type="text" id="product-seo-title" name="seo[title]" placeholder="SEO optimized title" value="">
                                                        </div>
                                                        <div class="form-group">
                                                            <label for="product-seo-description">SEO Description</label>
                                                            <textarea id="product-seo-description" name="seo[description]" rows="2" placeholder="SEO meta description"></textarea>
                                                        </div>
                                                        <div class="form-group">
                                                            <label>SEO Keywords</label>
                                                            <div class="addable-list-container">
                                                                <div class="input-with-button">
                                                                    <input type="text" id="new-seo-keyword-input" placeholder="Enter a keyword">
                                                                    <button type="button" class="add-item-btn" onclick="addSeoKeyword()">
                                                                        <i class="icon-plus"></i> Add
                                                                    </button>
                                                                </div>
                                                                <div class="items-list" id="seo-keywords-list"></div>
                                                            </div>
                                                            <input type="hidden" name="seo[keywords]" id="seo-keywords-input">
                                                        </div>
                                                    </div>
                                                    <div class="form-actions">
                                                        <button type="button" class="btn btn-secondary" onclick="closeModal('product-modal')">
                                                            <i class="icon-x"></i> Cancel
                                                        </button>
                                                        <button type="submit" class="btn btn-primary" id="product-modal-submit-btn">
                                                            <i class="icon-plus"></i> Create Product
                                                        </button>
                                                    </div>
                                                </form>
                                            </div>
                                        </div>
                                    </div>
                           

                                    <!-- CONFIRM DELETE MODAL -->
                                    <div class="modal" id="confirm-delete-modal" style="display:none;">
                                        <div class="modal-content modern-modal">
                                            <div class="modal-header">
                                                <h4><i class="icon-trash-2"></i> Confirm Delete</h4>
                                                <button type="button" class="close-btn" onclick="closeModal('confirm-delete-modal')"><i class="icon-x"></i></button>
                                            </div>
                                            <div class="modal-body">
                                                <p>Are you sure you want to delete this product?</p>
                                                <div class="form-actions">
                                                    <button type="button" class="btn btn-secondary" onclick="closeModal('confirm-delete-modal')">Cancel</button>
                                                    <button type="button" class="btn btn-danger" id="confirm-delete-btn"><i class="icon-trash-2"></i> Delete</button>
                                                </div>
                                            </div>
                                        </div>
                                    </div>

                                    <!-- Include SweetAlert2 CDN -->
                                    <script src="https://cdn.jsdelivr.net/npm/sweetalert2@11"></script>
                                    <script>
                                    // --- GLOBAL VARS ---
                                    let variantCounter = 0;
                                    let variantIdMap = []; 
                                    let selectedBeautyTips = [];
                                    let imageFiles = [];
                                    let editingProductId = null;
                                    let deleteProductId = null;

                                    document.addEventListener('DOMContentLoaded', function () {
                                        initializeProductForm();
                                        loadBeautyTips();
                                        setupCategoryDependencies();
                                        ['product-modal', 'confirm-delete-modal'].forEach(id => {
                                            var el = document.getElementById(id);
                                            if(el) el.style.display = 'none';
                                        });
                                    });

                                    function openProductModal(mode, product = null) {
                                        resetProductForm();
                                        const modal = document.getElementById('product-modal');
                                        if (!modal) return;

                                        if (mode === 'edit') {
                                            fillProductForm(product);
                                            document.getElementById('product-modal-title').innerText = 'Edit Product';
                                            document.getElementById('product-modal-submit-btn').innerHTML = '<i class="icon-edit"></i> Update Product';
                                            setTimeout(() => {
                                                // Set up category/subcat/childcat display for _id objects
                                                const catSel = document.getElementById('product-category');
                                                const subSel = document.getElementById('product-subCategory');
                                                const childSel = document.getElementById('product-childCategory');

                                                // If product contains objects instead of just string IDs
                                                if (product && catSel && product.category && typeof product.category === "object") {
                                                    catSel.value = product.category._id || product.category;
                                                }
                                                if (product && subSel && product.subCategory && typeof product.subCategory === "object") {
                                                    subSel.value = product.subCategory._id || product.subCategory;
                                                }
                                                if (product && childSel && product.childCategory && typeof product.childCategory === "object") {
                                                    childSel.value = product.childCategory._id || product.childCategory;
                                                }

                                                // trigger filters
                                                if (catSel) filterSubcategories(catSel.value);
                                                if (subSel) filterChildCategories(subSel.value);
                                            }, 120);
                                        } else {
                                            document.getElementById('product-modal-title').innerText = 'Add New Product';
                                            document.getElementById('product-modal-submit-btn').innerHTML = '<i class="icon-plus"></i> Create Product';
                                        }

                                        modal.style.display = 'block';
                                    }

                                    function closeModal(modalId) {
                                        var modal = document.getElementById(modalId);
                                        if (modal) modal.style.display = 'none';
                                    }
                                    function openDeleteModal(productId) {
                                        deleteProductId = productId;
                                        var modal = document.getElementById('confirm-delete-modal');
                                        if (modal) modal.style.display = 'block';
                                    }

                                    // ---- PRODUCT FORM LOGIC ----
function initializeProductForm() {
    // Image preview
    var imageInput = document.getElementById('product-images');
    if (imageInput) {
        imageInput.removeAttribute('required');
        imageInput.addEventListener('change', function (e) {
            const newFiles = Array.from(e.target.files);
            // Check for duplicates before adding
            newFiles.forEach(newFile => {
                const isDuplicate = imageFiles.some(existingFile =>
                    existingFile.name === newFile.name &&
                    existingFile.size === newFile.size &&
                    existingFile.lastModified === newFile.lastModified
                );
                if (!isDuplicate) {
                    imageFiles.push(newFile);
                }
            });
            renderImagePreview();
            // Reset the input to allow selecting same files again
            e.target.value = '';
        });
    }
    var titleInput = document.getElementById('product-title');
    if (titleInput) {
        titleInput.addEventListener('blur', function () {
            var slugInput = document.getElementById('product-slug');
            if (slugInput && !slugInput.value) slugInput.value = generateSlug(this.value);
        });
    }
    var form = document.getElementById('product-form');
    if (form) {
        form.addEventListener('submit', function (e) {
            e.preventDefault();
            if (editingProductId) {
                submitProductForm(this, 'PUT', '/updateProduct/' + editingProductId + '/update');
            } else {
                submitProductForm(this, 'POST', '/createProduct');
            }
        });
    }
    var deleteBtn = document.getElementById('confirm-delete-btn');
    if (deleteBtn) {
        deleteBtn.onclick = function () {
            if (deleteProductId) deleteProduct(deleteProductId);
        };
    }
}

function resetProductForm() {
    editingProductId = null;
    variantIdMap = [];
    var form = document.getElementById('product-form');
    if(form) form.reset();
    if(document.getElementById('product-image-preview-grid')) document.getElementById('product-image-preview-grid').innerHTML = '';
    imageFiles = [];
    selectedBeautyTips = [];
    updateBeautyTipsDisplay();
    updateBeautyTipsInput();
    ['tags-list','ingredients-list','benefits-list','seo-keywords-list'].forEach(id => {
        var el = document.getElementById(id); if(el) el.innerHTML = '';
    });
    var variantsContainer = document.getElementById('variants-container');
    if(variantsContainer) variantsContainer.innerHTML =
        `<div class="no-variants-message"><i class="icon-info"></i>
        <p>No variants added. Add variant types like Color, Size, etc.</p></div>`;
    variantCounter = 0;
    if(document.getElementById('edit-id')) document.getElementById('edit-id').value = '';
}

function fillProductForm(product) {
    if (!product) return;
    editingProductId = product._id;
    var get = id => document.getElementById(id);

    if(get('edit-id')) get('edit-id').value = product._id;
    if(get('product-title')) get('product-title').value = product.title || '';
    if(get('product-slug')) get('product-slug').value = product.slug || '';
    if(get('product-shortDescription')) get('product-shortDescription').value = product.shortDescription || '';
    if(get('product-description')) get('product-description').value = product.description || '';

    if(get('product-howToUse')) get('product-howToUse').value = product.howToUse || '';

    // Category fields (accept _id or value)
    if(get('product-category')) {
        if(product.category && typeof product.category === "object") {
            get('product-category').value = product.category._id || product.category;
        } else {
            get('product-category').value = product.category || '';
        }
    }
    if(get('product-subCategory')) {
        if(product.subCategory && typeof product.subCategory === "object") {
            get('product-subCategory').value = product.subCategory._id || product.subCategory;
        } else {
            get('product-subCategory').value = product.subCategory || '';
        }
    }
    if(get('product-childCategory')) {
        if(product.childCategory && typeof product.childCategory === "object") {
            get('product-childCategory').value = product.childCategory._id || product.childCategory;
        } else {
            get('product-childCategory').value = product.childCategory || '';
        }
    }

    if(get('product-brand')) get('product-brand').value = product.brand || '';
    if(get('product-productType')) get('product-productType').value = product.productType || '';
    if(get('product-ownerRef')) get('product-ownerRef').value = product.ownerRef || '';
    if(get('product-basePrice')) get('product-basePrice').value = product.basePrice || '';
    if(get('product-salePrice')) get('product-salePrice').value = product.salePrice || '';
    if(get('product-adminBasePrice')) get('product-adminBasePrice').value = product.adminBasePrice || '';
    if(get('product-adminSalePrice')) get('product-adminSalePrice').value = product.adminSalePrice || '';
    if(get('product-totalStock')) get('product-totalStock').value = product.totalStock || 0;
    if(get('product-weight')) get('product-weight').value = product.weight || '';
    if(get('product-length')) get('product-length').value = (product.dimensions && product.dimensions.length) || '';
    if(get('product-width')) get('product-width').value = (product.dimensions && product.dimensions.width) || '';
    if(get('product-height')) get('product-height').value = (product.dimensions && product.dimensions.height) || '';
    if(get('product-rating')) get('product-rating').value = product.rating || '';
    if(get('product-totalReviews')) get('product-totalReviews').value = product.totalReviews || '';
    if(get('product-status')) get('product-status').value = product.status || 'pending';
    if(get('product-totalSold')) get('product-totalSold').value = product.totalSold || 0;
    if(get('product-seo-title')) get('product-seo-title').value = product.seo?.title || '';
    if(get('product-seo-description')) get('product-seo-description').value = product.seo?.description || '';

    ['tags', 'benefits', 'ingredients'].forEach(field => {
        const values = product[field] || [];
        const listId = `${field}-list`;
        var el = get(listId); if(el) el.innerHTML = '';
        values.forEach(val => addListItem(listId, val, `${field}-input`));
    });
    (product.seo?.keywords || []).forEach(val => addListItem('seo-keywords-list', val, 'seo-keywords-input'));

    // Beauty tips expects an array of ids
    selectedBeautyTips = (product.beautyTips || []).map(function(b){
        if(typeof b === "object" && b._id) return b._id;
        return b;
    });
    updateBeautyTipsDisplay();
    updateBeautyTipsInput();

    // Images
    if (product.images && product.images.length) {
        renderImagePreviewFromUrls(product.images);

imageFiles = product.images.map(url => ({
    url,
    isExisting: true   
}));

    }

    // VARIANTS - Improved to handle _id and options with _id fields
    if (Array.isArray(product.variants) && product.variants.length) {
        const variantsContainer = document.getElementById('variants-container');
        if (variantsContainer) variantsContainer.innerHTML = '';
        variantCounter = 0;
        variantIdMap = [];
        product.variants.forEach((variant, vIdx) => {
            // Create a new variant section and get the DOM id
            const domId = addVariantSectionWithPreset(variant, vIdx);
            variantIdMap.push({ productVariantId: (variant._id || vIdx), domId });
        });
    }
}

// Helper to create variant section with options
function addVariantSectionWithPreset(variant, vIdx) {
    var container = document.getElementById('variants-container');
    if (!container) return null;
    var variantId = 'variant-' + (variantCounter++);
    var noVariantsMsg = container.querySelector('.no-variants-message');
    if (noVariantsMsg) noVariantsMsg.remove();

    var variantSection = document.createElement('div');
    variantSection.className = 'variant-section';
    variantSection.id = variantId;

    // Get the Variant name, handle direct `name` or fallback
    let nameVal = variant.name || '';
    variantSection.innerHTML = `
        <div class="variant-header">
            <h5>Variant Type</h5>
            <button type="button" class="btn btn-sm btn-danger" onclick="removeVariantSection('${variantId}')"><i class="icon-trash-2"></i> Remove</button>
        </div>
        <div class="form-grid">
            <div class="form-group">
                <label>Variant Name *</label>
                <input type="text" name="variants[${variantId}][name]" placeholder="e.g., Color, Size, Volume" value="${nameVal}" required>
            </div>
        </div>
        <div class="variant-options">
            <div class="options-header">
                <label>Variant Options</label>
                <button type="button" class="btn btn-sm btn-outline" onclick="addVariantOption('${variantId}')"><i class="icon-plus"></i> Add Option</button>
            </div>
            <div class="options-list" id="options-${variantId}"></div>
        </div>
    `;
    container.appendChild(variantSection);

    // Populate options if present
    var optList = variant.options && Array.isArray(variant.options) ? variant.options : [];
    optList.forEach((opt, oIdx) => {
        addVariantOptionWithPreset(variantId, opt, oIdx);
    });
    if (optList.length === 0) addVariantOption(variantId);

    return variantId;
}

// Add Option with preset data if present
function addVariantOptionWithPreset(variantId, optionData, oIdx) {
    const optionsList = document.getElementById(`options-${variantId}`);
    if (!optionsList) return;

    const optionId = 'option-' + Date.now() + Math.floor(Math.random() * 1000);
    const v = optionData || {};

    const option = document.createElement('div');
    option.className = 'variant-option';

    option.innerHTML = `
        <div class="option-header">
            <h6>Variant Option</h6>
            <button type="button" class="btn btn-sm btn-text" onclick="removeVariantOption(this)">
                <i class="icon-x"></i>
            </button>
        </div>

        <div class="form-grid">
            <div class="form-group">
                <label>Option Value *</label>
                <input type="text" 
                       name="variants[${variantId}][options][${optionId}][value]" 
                       value="${v.value || ''}"
                       required>
            </div>

            <div class="form-group">
                <label>Stock</label>
                <input type="number" min="0"
                       name="variants[${variantId}][options][${optionId}][stock]" 
                       value="${v.stock ?? ''}">
            </div>

            <div class="form-group">
                <label>SKU</label>
                <input type="text" 
                       name="variants[${variantId}][options][${optionId}][sku]" 
                       value="${v.sku || ''}">
            </div>

            <div class="form-group">
                <label>Price (₹)</label>
                <input type="number" step="0.01"
                       name="variants[${variantId}][options][${optionId}][price]"
                       value="${v.price ?? ''}">
            </div>

            <div class="form-group">
                <label>Admin Base Price (₹)</label>
                <input type="number" step="0.01"
                       name="variants[${variantId}][options][${optionId}][adminBasePrice]"
                       value="${v.adminBasePrice ?? ''}">
            </div>

            <div class="form-group">
                <label>Admin Sale Price (₹)</label>
                <input type="number" step="0.01"
                       name="variants[${variantId}][options][${optionId}][adminSalePrice]"
                       value="${v.adminSalePrice ?? ''}">
            </div>
        </div>

        <div class="form-group">
            <label>Option Images</label>

          <input type="file"
       class="variant-image-input"
       data-variant="${variantId}"
       data-option="${optionId}"
       multiple
       accept="image/*">


        <input type="hidden"
       class="variant-image-count"
       name="imageCount__${variantId}__${optionId}"
       value="0">


            <div class="image-preview-grid option-images-preview" id="preview-${optionId}"></div>
        </div>
    `;

    optionsList.appendChild(option);

    // Load existing variant images (urls)
    if (Array.isArray(v.images)) {
        const previewGrid = option.querySelector(".option-images-preview");

        v.images.forEach((imgUrl, index) => {
            const img = document.createElement("div");
            img.className = "preview-image";
            img.innerHTML = `
                <div class="image-wrapper">
                    <img src="${imgUrl}">
                    <div class="image-overlay"><span>${index + 1}</span></div>
                </div>
            `;
            previewGrid.appendChild(img);
        });

        const hiddenInput = document.createElement("input");
hiddenInput.type = "hidden";
hiddenInput.name = `existingImages__${variantId}__${optionId}`;
hiddenInput.value = JSON.stringify(v.images);
option.appendChild(hiddenInput);

    }

    // File input handling
    const fileInput = option.querySelector(".variant-image-input");
    fileInput.addEventListener("change", function (e) {
        const previewGrid = option.querySelector(".option-images-preview");
        previewImages(e, previewGrid);

        const countInput = option.querySelector(".variant-image-count");
        countInput.value = e.target.files.length;
    });
}

function addVariantSection() {
    var container = document.getElementById('variants-container');
    if (!container) return;
    var variantId = 'variant-' + (variantCounter++);
    var noVariantsMsg = container.querySelector('.no-variants-message');
    if (noVariantsMsg) noVariantsMsg.remove();
    var variantSection = document.createElement('div');
    variantSection.className = 'variant-section';
    variantSection.id = variantId;
    variantSection.innerHTML = `
        <div class="variant-header">
            <h5>Variant Type</h5>
            <button type="button" class="btn btn-sm btn-danger" onclick="removeVariantSection('${variantId}')"><i class="icon-trash-2"></i> Remove</button>
        </div>
        <div class="form-grid">
            <div class="form-group">
                <label>Variant Name *</label>
                <input type="text" name="variants[${variantId}][name]" placeholder="e.g., Color, Size, Volume" required>
            </div>
        </div>
        <div class="variant-options">
            <div class="options-header">
                <label>Variant Options</label>
                <button type="button" class="btn btn-sm btn-outline" onclick="addVariantOption('${variantId}')"><i class="icon-plus"></i> Add Option</button>
            </div>
            <div class="options-list" id="options-${variantId}"></div>
        </div>
    `;
    container.appendChild(variantSection);
    addVariantOption(variantId);
    return variantId;
}

function addVariantOption(variantId) {
    const optionsList = document.getElementById(`options-${variantId}`);
    if (!optionsList) return;

    const optionId = 'option-' + Date.now() + Math.floor(Math.random() * 1000);

    const option = document.createElement('div');
    option.className = 'variant-option';
    option.innerHTML = `
        <div class="option-header">
            <h6>Variant Option</h6>
            <button type="button" class="btn btn-sm btn-text" onclick="removeVariantOption(this)">
                <i class="icon-x"></i>
            </button>
        </div>

        <div class="form-grid">
            <div class="form-group">
                <label>Option Value *</label>
                <input type="text" 
                       name="variants[${variantId}][options][${optionId}][value]" 
                       required>
            </div>

            <div class="form-group">
                <label>Stock</label>
                <input type="number" min="0" 
                       name="variants[${variantId}][options][${optionId}][stock]">
            </div>

            <div class="form-group">
                <label>SKU</label>
                <input type="text" 
                       name="variants[${variantId}][options][${optionId}][sku]">
            </div>

            <div class="form-group">
                <label>Price (₹)</label>
                <input type="number" step="0.01"
                       name="variants[${variantId}][options][${optionId}][price]">
            </div>

            <div class="form-group">
                <label>Admin Base Price (₹)</label>
                <input type="number" step="0.01"
                       name="variants[${variantId}][options][${optionId}][adminBasePrice]">
            </div>

            <div class="form-group">
                <label>Admin Sale Price (₹)</label>
                <input type="number" step="0.01"
                       name="variants[${variantId}][options][${optionId}][adminSalePrice]">
            </div>
        </div>

        <div class="form-group">
            <label>Option Images</label>

            <!-- IMPORTANT: images[] FORMAT -->
            <input type="file"
                   name="variants[${variantId}][options][${optionId}][images][]" 
                   multiple 
                   accept="image/*"
                   class="variant-image-input">

            <!-- COUNT FIELD (backend reads this) -->
            <input type="hidden"
                   class="variant-image-count"
                 name="imageCount__${variantId}__${optionId}"
                   value="0">

            <div class="image-preview-grid option-images-preview" id="preview-${optionId}"></div>
        </div>
    `;

    optionsList.appendChild(option);

    // Register file change handler
    const fileInput = option.querySelector(".variant-image-input");
    fileInput.addEventListener("change", function (e) {
        const previewGrid = option.querySelector(".option-images-preview");
        previewImages(e, previewGrid);

        const countInput = option.querySelector(".variant-image-count");
        countInput.value = e.target.files.length;
    });
}

// Remainder (removeVariantSection etc) - same as previous
function removeVariantSection(variantId) {
    var section = document.getElementById(variantId);
    if (section) {
        section.remove();
        var container = document.getElementById('variants-container');
        if (container && !container.querySelector('.variant-section')) {
            container.innerHTML = `<div class="no-variants-message"><i class="icon-info"></i><p>No variants added. Add variant types like Color, Size, etc.</p></div>`;
        }
    }
}
function removeVariantOption(button) {
    var option = button.closest('.variant-option');
    if (option) option.remove();
}

function previewImages(event, previewGridId) {
    var files = Array.from(event.target.files);
    var previewGrid = typeof previewGridId === 'string' ? document.getElementById(previewGridId) : previewGridId;
    if(!previewGrid) {
        console.error('Preview grid not found:', previewGridId);
        return;
    }
    previewGrid.innerHTML = '';
    if (files.length === 0) {
        previewGrid.innerHTML = '<div class="no-images-message">No images selected</div>';
        return;
    }
    files.forEach((file, index) => {
        if (file.type.startsWith('image/')) {
            var reader = new FileReader();
            reader.onload = function (e) {
                var imgContainer = document.createElement('div');
                imgContainer.className = 'preview-image variant-preview-image';
                imgContainer.innerHTML = `
                    <div class="image-wrapper">
                        <img src="${e.target.result}" alt="Variant Preview ${index + 1}" />
                        <div class="image-overlay">
                            <span class="img-position">${index + 1}</span>
                        </div>
                    </div>
                    <div class="preview-controls">
                        <button type="button" class="remove-preview" onclick="removeVariantImage(this)" title="Remove Image">
                            <i class="icon-x"></i>
                        </button>
                    </div>
                `;
                previewGrid.appendChild(imgContainer);
            };
            reader.readAsDataURL(file);
        }
    });
}
function removeVariantImage(button) {
    if (typeof Swal === "undefined") {
        if (confirm('Are you sure you want to remove this image?')) {
            button.closest('.preview-image').remove();
        }
        return;
    }
    Swal.fire({
        title: 'Remove Image?',
        text: "This image will be removed from the variant.",
        icon: 'warning',
        showCancelButton: true,
        confirmButtonColor: '#d33',
        cancelButtonColor: '#3085d6',
        confirmButtonText: 'Yes, remove it!',
        cancelButtonText: 'Cancel'
    }).then((result) => {
        if (result.isConfirmed) {
            button.closest('.preview-image').remove();
        }
    });
}

function renderImagePreview() {
    var grid = document.getElementById('product-image-preview-grid');
    if (!grid) return;
    grid.innerHTML = '';
    if (!imageFiles || imageFiles.length === 0) {
        grid.innerHTML = '<div class="no-images-message">No images selected</div>';
        return;
    }
    imageFiles.forEach((file, idx) => {
        var reader = new FileReader();
        reader.onload = function (e) {
            var imgContainer = document.createElement('div');
            imgContainer.className = 'preview-image';
            imgContainer.setAttribute('data-index', idx);
            imgContainer.innerHTML = `
                <div class="image-wrapper">
                    <img src="${e.target.result}" alt="Preview ${idx + 1}" />
                    <div class="image-overlay">
                        <span class="img-position">${idx + 1}</span>
                    </div>
                </div>
                <div class="preview-controls">
                    <button type="button" class="move-btn move-left" ${idx === 0 ? 'disabled' : ''} 
                            onclick="moveImagePreview(${idx}, 'left')" title="Move Left">
                        <i class="icon-chevron-left"></i>
                    </button>
                    <button type="button" class="move-btn move-right" ${idx === imageFiles.length - 1 ? 'disabled' : ''} 
                            onclick="moveImagePreview(${idx}, 'right')" title="Move Right">
                        <i class="icon-chevron-right"></i>
                    </button>
                    <button type="button" class="remove-preview" onclick="removeImagePreview(${idx})" title="Remove Image">
                        <i class="icon-x"></i>
                    </button>
                </div>
            `;
            grid.appendChild(imgContainer);
        };
        reader.readAsDataURL(file);
    });
}

function renderImagePreviewFromUrls(urls) {
    var grid = document.getElementById('product-image-preview-grid');
    if (!grid) return;
    grid.innerHTML = '';
    urls.forEach((url, idx) => {
        var imgContainer = document.createElement('div');
        imgContainer.className = 'preview-image';
        imgContainer.innerHTML = `
            <div class="image-wrapper">
                <img src="${url}" alt="Preview ${idx + 1}">
                <div class="image-overlay">
                    <span class="img-position">${idx + 1}</span>
                </div>
            </div>
            <div class="preview-controls">
                <button type="button" class="move-btn" disabled><i class="icon-chevron-left"></i></button>
                <button type="button" class="move-btn" disabled><i class="icon-chevron-right"></i></button>
                <button type="button" class="remove-preview disabled" disabled><i class="icon-x"></i></button>
            </div>
        `;
        grid.appendChild(imgContainer);
    });
}

function moveImagePreview(currentIdx, direction) {
    if (!imageFiles.length || imageFiles.length < 2) return;
    let newIdx = direction === 'left' ? currentIdx - 1 : currentIdx + 1;
    if (newIdx < 0 || newIdx >= imageFiles.length) return;
    [imageFiles[currentIdx], imageFiles[newIdx]] = [imageFiles[newIdx], imageFiles[currentIdx]];
    renderImagePreview();
}

function removeImagePreview(idx) {
    if (typeof Swal === "undefined") {
        if (confirm('Are you sure you want to remove this image?')) {
            imageFiles.splice(idx, 1);
            renderImagePreview();
        }
        return;
    }
    Swal.fire({
        title: 'Remove Image?',
        text: "This image will be removed from the product.",
        icon: 'warning',
        showCancelButton: true,
        confirmButtonColor: '#d33',
        cancelButtonColor: '#3085d6',
        confirmButtonText: 'Yes, remove it!',
        cancelButtonText: 'Cancel'
    }).then((result) => {
        if (result.isConfirmed) {
            imageFiles.splice(idx, 1);
            renderImagePreview();
            Swal.fire({
                title: 'Removed!',
                text: 'Image has been removed.',
                icon: 'success',
                timer: 1000,
                showConfirmButton: false
            });
        }
    });
}


function generateSlug(text) {
    return (text||'')
        .toLowerCase()
        .trim()
        .replace(/[^\w\s-]/g, '')
        .replace(/[\s_-]+/g, '-')
        .replace(/^-+|-+$/g, '');
}

// --- CATEGORY DEPENDENCY (Unchanged) ---
function setupCategoryDependencies() {
    const categorySelect = document.getElementById('product-category');
    const subcategorySelect = document.getElementById('product-subCategory');
    const childcategorySelect = document.getElementById('product-childCategory');
    if (categorySelect) {
        categorySelect.addEventListener('change', function () {
            const categoryId = this.value;
            filterSubcategories(categoryId);
            if (childcategorySelect) {
                childcategorySelect.value = '';
                filterChildCategories('');
            }
        });
    }
    if (subcategorySelect) {
        subcategorySelect.addEventListener('change', function () {
            const subcategoryId = this.value;
            filterChildCategories(subcategoryId);
        });
    }
}
function filterSubcategories(categoryId) {
    const subcategorySelect = document.getElementById('product-subCategory');
    if (!subcategorySelect) return;
    const options = subcategorySelect.querySelectorAll('option');
    options.forEach(option => {
        if (option.value === '') {
            option.style.display = '';
            option.disabled = false;
            return;
        }
        const optionCategoryId = option.getAttribute('data-categoryid');
        const shouldShow = !categoryId || optionCategoryId === categoryId;
        option.style.display = shouldShow ? '' : 'none';
        option.disabled = !shouldShow;
    });
    const currentValue = subcategorySelect.value;
    const currentOption = subcategorySelect.querySelector(`option[value="${currentValue}"]`);
    if (!currentOption || currentOption.style.display === 'none' || currentOption.disabled) {
        subcategorySelect.value = '';
    }
}
function filterChildCategories(subcategoryId) {
    const childcategorySelect = document.getElementById('product-childCategory');
    const categorySelect = document.getElementById('product-category');
    if (!childcategorySelect) return;
    const categoryId = categorySelect ? categorySelect.value : '';
    const options = childcategorySelect.querySelectorAll('option');
    options.forEach(option => {
        if (option.value === '') {
            option.style.display = '';
            option.disabled = false;
            return;
        }
        const optionCategoryId = option.getAttribute('data-categoryid');
        const optionSubcategoryId = option.getAttribute('data-subcategoryid');
        const shouldShow = (!categoryId || optionCategoryId === categoryId) && 
        (!subcategoryId || optionSubcategoryId === subcategoryId);
        option.style.display = shouldShow ? '' : 'none';
        option.disabled = !shouldShow;
    });
    const currentValue = childcategorySelect.value;
    const currentOption = childcategorySelect.querySelector(`option[value="${currentValue}"]`);
    if (!currentOption || currentOption.style.display === 'none' || currentOption.disabled) {
        childcategorySelect.value = '';
    }
}

// --- BEAUTY TIPS MULTISELECT ---

async function loadBeautyTips() {
    try {
        const response = await fetch('/beautytips');
        let beautyTips = await response.json();
        if(Array.isArray(beautyTips)) {}
        else if(beautyTips && Array.isArray(beautyTips.tips)) beautyTips = beautyTips.tips;
        else if(beautyTips && Array.isArray(beautyTips.data)) beautyTips = beautyTips.data;
        else beautyTips = [];
        populateBeautyTipsDropdown(beautyTips);
    } catch (error) {}
}
function populateBeautyTipsDropdown(beautyTips) {
    var dropdown = document.getElementById('beauty-tips-dropdown');
    if (!dropdown) return;
    var optionsList = dropdown.querySelector('.options-list');
    if (!optionsList) return;
    if (!Array.isArray(beautyTips) || beautyTips.length === 0) {
        optionsList.innerHTML = '<div class="no-options">No beauty tips available</div>';
        return;
    }
    optionsList.innerHTML = beautyTips.map(tip => `
        <div class="option-item" data-value="${tip._id}">
            <label class="checkbox-label">
                <input type="checkbox" value="${tip._id}" onchange="toggleBeautyTip(this)">
                <span class="checkmark"></span>
                <div class="option-content">
                    <div class="option-title">${tip.title}</div>
                    <div class="option-description">${tip.shortDescription ? tip.shortDescription : 'No description'}</div>
                </div>
            </label>
        </div>
    `).join('');

    // Re-check previously selected tips if editing
    selectedBeautyTips.forEach(val => {
        let cb = optionsList.querySelector(`input[type="checkbox"][value="${val}"]`);
        if(cb) cb.checked = true;
    });
}

function toggleBeautyTipsDropdown() {
    var dropdown = document.getElementById('beauty-tips-dropdown');
    if (dropdown) dropdown.classList.toggle('show');
}
function toggleBeautyTip(checkbox) {
    var tipId = checkbox.value;
    var isChecked = checkbox.checked;
    if (isChecked) {
        if (!selectedBeautyTips.includes(tipId)) selectedBeautyTips.push(tipId);
    } else {
        selectedBeautyTips = selectedBeautyTips.filter(id => id !== tipId);
    }
    updateBeautyTipsDisplay();
    updateBeautyTipsInput();
}
function updateBeautyTipsDisplay() {
    var display = document.getElementById('beauty-tips-display');
    if (!display) return;
    if (!selectedBeautyTips || selectedBeautyTips.length === 0) {
        display.innerHTML = '<span class="placeholder">No beauty tips selected</span>';
        return;
    }
    var selectedMap = {};
    var optionItems = document.querySelectorAll('#beauty-tips-dropdown .option-item');
    optionItems.forEach(optionItem => {
        var checkbox = optionItem.querySelector('input[type="checkbox"]');
        if (checkbox && selectedBeautyTips.includes(checkbox.value)) {
            var title = optionItem.querySelector('.option-title').textContent;
            selectedMap[checkbox.value] = title;
        }
    });
    display.innerHTML = Object.entries(selectedMap).map(([id, title]) => `
        <span class="selected-item">
            ${title}
            <button type="button" class="remove-item" onclick="removeBeautyTipById('${id}')"><i class="icon-x"></i></button>
        </span>
    `).join('');
}
function removeBeautyTipById(id) {
    var checkbox = document.querySelector(`#beauty-tips-dropdown input[type="checkbox"][value="${id}"]`);
    if (checkbox) {
        checkbox.checked = false;
        toggleBeautyTip(checkbox);
    }
}
function updateBeautyTipsInput() {
    var input = document.getElementById('beauty-tips-input');
    if(input) input.value = JSON.stringify(selectedBeautyTips);
}
function selectAllBeautyTips() {
    var checkboxes = document.querySelectorAll('#beauty-tips-dropdown input[type="checkbox"]');
    checkboxes.forEach(checkbox => {
        checkbox.checked = true;
        if (!selectedBeautyTips.includes(checkbox.value)) selectedBeautyTips.push(checkbox.value);
    });
    updateBeautyTipsDisplay();
    updateBeautyTipsInput();
}
function clearBeautyTips() {
    var checkboxes = document.querySelectorAll('#beauty-tips-dropdown input[type="checkbox"]');
    checkboxes.forEach(checkbox => checkbox.checked = false);
    selectedBeautyTips = [];
    updateBeautyTipsDisplay();
    updateBeautyTipsInput();
}

// ---- ADDABLE LISTS (tags, etc) ----
function addTag() {
    var input = document.getElementById('new-tag-input');
    var value = input.value.trim();
    if (value) {
        addListItem('tags-list', value, 'tags-input');
        input.value = '';
    }
}
function addIngredient() {
    var input = document.getElementById('new-ingredient-input');
    var value = input.value.trim();
    if (value) {
        addListItem('ingredients-list', value, 'ingredients-input');
        input.value = '';
    }
}
function addBenefit() {
    var input = document.getElementById('new-benefit-input');
    var value = input.value.trim();
    if (value) {
        addListItem('benefits-list', value, 'benefits-input');
        input.value = '';
    }
}
function addSeoKeyword() {
    var input = document.getElementById('new-seo-keyword-input');
    var value = input.value.trim();
    if (value) {
        addListItem('seo-keywords-list', value, 'seo-keywords-input');
        input.value = '';
    }
}
function addListItem(listId, value, inputId) {
    var list = document.getElementById(listId);
    var itemId = 'item-' + Date.now() + Math.floor(Math.random()*1000);
    var item = document.createElement('div');
    item.className = 'list-item';
    item.id = itemId;
    item.innerHTML = `
        <span>${value}</span>
        <button type="button" class="remove-item" onclick="removeListItem('${itemId}', '${inputId}')"><i class="icon-x"></i></button>
        <input type="hidden" name="${inputId}[]" value="${value}">
    `;
    if (list) list.appendChild(item);
    updateListInput(inputId);
}
function removeListItem(itemId, inputId) {
    var item = document.getElementById(itemId);
    if (item) {
        item.remove();
        updateListInput(inputId);
    }
}
function updateListInput(inputId) {
    var list = document.getElementById(inputId.replace('-input', '-list'));
    if(!list) return;
    var items = list.querySelectorAll('.list-item');
    var values = Array.from(items).map(item => item.querySelector('span').textContent);
    var hiddenInput = document.getElementById(inputId);
    if(hiddenInput) hiddenInput.value = JSON.stringify(values);
}

function setupFileUploadArea() {
    const fileUploadArea = document.getElementById('product-file-upload-area');
    const fileInput = document.getElementById('product-images');
    if (!fileUploadArea || !fileInput) return;
    ['dragenter', 'dragover', 'dragleave', 'drop'].forEach(eventName => {
        fileUploadArea.addEventListener(eventName, preventDefaults, false);
        document.body.addEventListener(eventName, preventDefaults, false);
    });
    ['dragenter', 'dragover'].forEach(eventName => {
        fileUploadArea.addEventListener(eventName, highlight, false);
    });
    ['dragleave', 'drop'].forEach(eventName => {
        fileUploadArea.addEventListener(eventName, unhighlight, false);
    });
    fileUploadArea.addEventListener('drop', handleDrop, false);
    function preventDefaults(e) { e.preventDefault(); e.stopPropagation(); }
    function highlight() { fileUploadArea.classList.add('highlight'); }
    function unhighlight() { fileUploadArea.classList.remove('highlight'); }
    function handleDrop(e) {
        const dt = e.dataTransfer;
        const files = dt.files;
        if (files.length > 0) {
            const newFiles = Array.from(files);
            newFiles.forEach(file => {
                if (file.type.startsWith('image/')) {
                    const isDuplicate = imageFiles.some(existingFile =>
                        existingFile.name === file.name &&
                        existingFile.size === file.size
                    );
                    if (!isDuplicate) {
                        imageFiles.push(file);
                    }
                }
            });
            renderImagePreview();
        }
    }
}

// Init all on DOMReady
document.addEventListener('DOMContentLoaded', function () {
    initializeProductForm();
    loadBeautyTips();
    setupCategoryDependencies();
    setupFileUploadArea();
    ['product-modal', 'confirm-delete-modal'].forEach(id => {
        var el = document.getElementById(id);
        if(el) el.style.display = 'none';
    });
});

// ---- CREATE / EDIT / DELETE / TOGGLE STATUS ----
async function submitProductForm(form, method, url) {
    const formData = new FormData(form);

    // Allow hidden inputs
    document.querySelectorAll(".variant-image-count").forEach(i => i.disabled = false);
    document.querySelectorAll("input[name*='existingImages']").forEach(i => i.disabled = false);

    // Replace MAIN images
    formData.delete("images");
    imageFiles.forEach(file => {
        formData.append("images", file);
    });

    document.querySelectorAll(".variant-image-input").forEach(input => {
    const variantId = input.dataset.variant;
    const optionId = input.dataset.option;

    if (!variantId || !optionId) {
        console.error("❌ Variant or option missing!", input);
        return;
    }

    const fieldName = `variantFile__${variantId}__${optionId}`;

    Array.from(input.files).forEach(file => {
        formData.append(fieldName, file);
    });
});


    try {
        const submitBtn = form.querySelector("button[type='submit']");
        submitBtn.disabled = true;
        submitBtn.innerHTML = '<i class="icon-loader"></i> Saving...';

        const response = await fetch(url, {
            method,
            body: formData
        });

        if (!response.ok) throw new Error("Failed to save product");

        Swal.fire({
            icon: "success",
            title: method === "POST" ? "Product Created!" : "Product Updated!",
            timer: 1500,
            showConfirmButton: false
        }).then(() => {
            closeModal("product-modal");
            window.location.reload();
        });

    } catch (err) {
        Swal.fire({
            icon: "error",
            title: "Error",
            text: err.message
        });
    }
}

async function deleteProduct(productId) {
    if (typeof Swal === "undefined") {
        alert("Swal is not defined");
        return;
    }
    Swal.fire({
        title: 'Are you sure?',
        text: "This will permanently delete the product.",
        icon: 'warning',
        showCancelButton: true,
        confirmButtonColor: '#d33',
        cancelButtonColor: '#3085d6',
        confirmButtonText: 'Yes, delete it!',
        cancelButtonText: 'Cancel'
    }).then(async (result) => {
        if (result.isConfirmed) {
            try {
                const response = await fetch(`/product/${productId}/delete`, { method: 'DELETE' });
                if (response.ok) {
                    Swal.fire({ icon: 'success', title: 'Deleted', timer: 1500, showConfirmButton: false })
                    .then(()=>{closeModal('confirm-delete-modal'); window.location.reload(); });
                } else {
                    const error = await response.json();
                    Swal.fire({ icon: 'error', title: 'Error', text: (error && error.message) || 'Delete failed' });
                    throw new Error(error.message || 'Deletion failed');
                }
            } catch (error) {
                Swal.fire({ icon: 'error', title: 'Error', text: (error && error.message) || 'Delete failed' });
            }
        }
    });
}

async function toggleProductStatus(productId, currentStatus) {
    if (typeof Swal === "undefined") {
        alert("Swal is not defined");
        return;
    }
    try {
        const response = await fetch(`/product/${productId}/toggle-status`, { method: 'PATCH' });
        if (response.ok) {
            Swal.fire({ icon: 'success', title: 'Status changed', timer: 1200, showConfirmButton: false })
            .then(()=>window.location.reload());
        } else {
            Swal.fire({ icon: 'error', title: 'Error', text: 'Failed to toggle status' });
            throw new Error('Failed to toggle status');
        }
    } catch (error) {
        Swal.fire({ icon: 'error', title: 'Error', text: (error && error.message) || 'Failed to change status' });
    }
}

                                    </script>
                                  
                                 

                                    <!-- /product-list -->
                            </div>
                            <!-- /main-content-wrap -->
                        </div>
                        <!-- /main-content-wrap -->
                        <!-- bottom-page -->
                        <div class="bottom-page">
                            <div class="body-text">Copyright © 2025 <a href="">Blushley</a>.
                                Design by Trivlogic Private Limited All rights reserved</div>
                        </div>
                        <!-- /bottom-page -->
                    </div>
                    <!-- /main-content -->
                </div>
                <!-- /section-content-right -->
            </div>
            <!-- /layout-wrap -->
        </div>
        <!-- /#page -->
    </div>
    <!-- /#wrapper -->

    <!-- Javascript -->
    <script src="/admin-js/jquery.min.js"></script>
    <script src="/admin-js/bootstrap.min.js"></script>
    <script src="/admin-js/bootstrap-select.min.js"></script>
    <script src="/admin-js/zoom.js"></script>
    <script src="/admin-js/switcher.js"></script>
    <script defer src="/admin-js/theme-settings.js"></script>
    <script defer src="/admin-js/main.js"></script>

</body>

</html>