<!DOCTYPE html>
<html xmlns="http://www.w3.org/1999/xhtml" xml:lang="en-US" lang="en-US">

<head>
    <!-- Basic Page Needs -->
    <meta charset="utf-8">
  
    <title>Teraxo - Admin Blogs</title>
    <!-- Mobile Specific Metas -->
    <meta name="viewport" content="width=device-width, initial-scale=1, maximum-scale=1">

    <!-- Theme Style -->
    <link rel="stylesheet" type="text/css" href="/admin-css/animate.min.css">
    <link rel="stylesheet" type="text/css" href="/admin-css/animation.css">
    <link rel="stylesheet" type="text/css" href="/admin-css/bootstrap.css">
    <link rel="stylesheet" type="text/css" href="/admin-css/bootstrap-select.min.css">
    <link rel="stylesheet" type="text/css" href="/admin-css/styles.css">
    <link rel="stylesheet" href="https://cdnjs.cloudflare.com/ajax/libs/font-awesome/4.7.0/css/font-awesome.min.css">


    <!-- Font -->
    <link rel="stylesheet" href="/admin-font/fonts.css">

    <!-- Icon -->
    <link rel="stylesheet" href="/admin-icon/style.css">

    <!-- Favicon and Touch Icons  -->
    <link rel="shortcut icon" href="/images/teraxo/logo.png">
    <link rel="apple-touch-icon-precomposed" href="/images/teraxo/logo.png">
    <style>
        /* Ensure toggle switch is visible */
        .peer:checked~.peer-checked\:bg-blue-600 {
            background-color: #2563eb;
        }

        /* Fix icon alignment */
        .icon-edit,
        .icon-trash-2 {
            display: inline-flex;
            align-items: center;
            justify-content: center;
        }

        /* Toggle switch styles */
        .toggle-checkbox:checked {
            right: 0;
            border-color: #3B82F6;
        }

        .toggle-checkbox:checked+.toggle-label {
            background-color: #3B82F6;
        }

        .modal {
            display: none;
            position: fixed;
            z-index: 1000;
            left: 0;
            top: 0;
            width: 100%;
            height: 100%;
            background-color: rgba(0, 0, 0, 0.5);
        }

        .modal-content {
            background-color: #fff;
            margin: 10% auto;
            padding: 20px;
            border-radius: 8px;
            width: 500px;
            max-width: 90%;
        }

        .close {
            color: #aaa;
            float: right;
            font-size: 28px;
            font-weight: bold;
            cursor: pointer;
        }

        .close:hover {
            color: #000;
        }

        .form-group {
            margin-bottom: 15px;
        }

        .form-group label {
            display: block;
            margin-bottom: 5px;
            font-weight: 500;
        }

        .form-group input,
        .form-group select {
            width: 100%;
            padding: 8px;
            border: 1px solid #ddd;
            border-radius: 4px;
        }

        /* Icons styling */
        .icon-edit,
        .icon-trash-2 {
            vertical-align: middle;
            margin-right: 5px;
        }

        /* Image dimensions */
        .wg-table .w-40 img {
            width: 160px;
            height: 120px;
            object-fit: cover;
            border-radius: 4px;
        }

        #currentImagePreview img {
            width: 100%;
            height: 200px;
            object-fit: contain;
            border: 1px solid #eee;
            border-radius: 4px;
        }

        /* This is already included in the HTML classes above, but just in case */
        .toggle-switch {
            position: relative;
            display: inline-block;
            width: 60px;
            height: 34px;
        }

        .toggle-switch input {
            opacity: 0;
            width: 0;
            height: 0;
        }

        .toggle-slider {
            position: absolute;
            cursor: pointer;
            top: 0;
            left: 0;
            right: 0;
            bottom: 0;
            background-color: #ccc;
            transition: .4s;
            border-radius: 34px;
        }

        .toggle-slider:before {
            position: absolute;
            content: "";
            height: 26px;
            width: 26px;
            left: 4px;
            bottom: 4px;
            background-color: white;
            transition: .4s;
            border-radius: 50%;
        }

        input:checked+.toggle-slider {
            background-color: #2196F3;
        }

        input:checked+.toggle-slider:before {
            transform: translateX(26px);
        }
    </style>
</head>

<body class="body">

    <!-- #wrapper -->
    <div id="wrapper">
        <!-- #page -->
        <div id="page" class="">
            <!-- layout-wrap -->
            <div class="layout-wrap loader-off">
                <!-- preload -->
                <div id="preload" class="preload-container">
                    <div class="preloading">
                        <span></span>
                    </div>
                </div>
                <!-- /preload -->
                <!-- section-menu-left -->
            <div class="section-menu-left">
                    <div class="box-logo">
                        <a href="/admin/dashboard" id="site-logo-inner">
                            <img style="width:60px;" id="logo_header" alt="logo" src="/images/teraxo/logo.png"
                                data-light="/images/teraxo/logo.png" data-dark="/images/teraxo/logo.png">
                        </a>
                        <div class="button-show-hide">
                            <i class="icon-chevron-left"></i>
                        </div>
                    </div>
                    <div class="section-menu-left-wrap">
                        <div class="center">
                            <div class="center-item">
                                <ul>
                                    <li class="menu-item">
                                        <a href="/admin/dashboard">
                                            <div class="icon">
                                                <svg width="24" height="24" viewBox="0 0 24 24" fill="none"
                                                    xmlns="http://www.w3.org/2000/svg">
                                                    <path fill-rule="evenodd" clip-rule="evenodd"
                                                        d="M12.2652 3.57566C12.1187 3.42921 11.8813 3.42921 11.7348 3.57566L5.25 10.0605V19.8748C5.25 20.0819 5.41789 20.2498 5.625 20.2498H9V16.1248C9 15.0893 9.83947 14.2498 10.875 14.2498H13.125C14.1605 14.2498 15 15.0893 15 16.1248V20.2498H18.375C18.5821 20.2498 18.75 20.0819 18.75 19.8748V10.0605L12.2652 3.57566ZM20.25 11.5605L21.2197 12.5302C21.5126 12.8231 21.9874 12.8231 22.2803 12.5302C22.5732 12.2373 22.5732 11.7624 22.2803 11.4695L13.3258 2.51499C12.5936 1.78276 11.4064 1.78276 10.6742 2.515L1.71967 11.4695C1.42678 11.7624 1.42678 12.2373 1.71967 12.5302C2.01256 12.8231 2.48744 12.8231 2.78033 12.5302L3.75 11.5605V19.8748C3.75 20.9104 4.58947 21.7498 5.625 21.7498H18.375C19.4105 21.7498 20.25 20.9104 20.25 19.8748V11.5605ZM13.5 20.2498H10.5V16.1248C10.5 15.9177 10.6679 15.7498 10.875 15.7498H13.125C13.3321 15.7498 13.5 15.9177 13.5 16.1248V20.2498Z"
                                                        fill="#111111" />
                                                </svg>
                                            </div>
                                            <div class="text">Admin Dashboard</div>
                                        </a>
                                    </li>
                                    
                              

                                    <li class="menu-item">
                                        <a href="/admin/products" class="menu-item-button">
                                            <div class="icon"><i class="icon-shopping-bag"></i></div>
                                            <div class="text">Product Management</div>
                                        </a>
                                    </li>
                                 
                               



                             

                                

                                    <li class="menu-item">
                                        <a href="/admin/banner" class="menu-item-button">
                                            <div class="icon"><i class="icon-image"></i></div>
                                            <div class="text">Banner Management</div>
                                        </a>
                                    </li>

                                    <li class="menu-item">
                                        <a href="/admin/testimonials" class="menu-item-button">
                                            <div class="icon"><i class="fa fa-star-o"></i></div>
                                            <div class="text">Testimonials Management</div>
                                        </a>
                                    </li>

                                    <li class="menu-item active">
                                        <a href="/admin/blogs" class="menu-item-button">
                                            <div class="icon"><i class="icon-book-open"></i></div>
                                            <div class="text">Blogs Management</div>
                                        </a>
                                    </li>

                                    <li class="menu-item">
                                        <a href="/admin/logout">
                                            <div class="icon">
                                                <svg width="24" height="22" viewBox="0 0 20 20" fill="none"
                                                    xmlns="http://www.w3.org/2000/svg">
                                                    <path
                                                        d="M8.125 18.6875C8.125 18.903 8.0394 19.1097 7.88702 19.262C7.73465 19.4144 7.52799 19.5 7.3125 19.5H1.625C1.19402 19.5 0.780698 19.3288 0.475951 19.024C0.171205 18.7193 0 18.306 0 17.875V1.625C0 1.19402 0.171205 0.780698 0.475951 0.475951C0.780698 0.171205 1.19402 0 1.625 0H7.3125C7.52799 0 7.73465 0.0856026 7.88702 0.237976C8.0394 0.390349 8.125 0.597012 8.125 0.8125C8.125 1.02799 8.0394 1.23465 7.88702 1.38702C7.73465 1.5394 7.52799 1.625 7.3125 1.625H1.625V17.875H7.3125C7.52799 17.875 7.73465 17.9606 7.88702 18.113C8.0394 18.2653 8.125 18.472 8.125 18.6875ZM19.2623 9.17516L15.1998 5.11266C15.0474 4.9602 14.8406 4.87455 14.625 4.87455C14.4094 4.87455 14.2026 4.9602 14.0502 5.11266C13.8977 5.26511 13.812 5.47189 13.812 5.6875C13.812 5.90311 13.8977 6.10989 14.0502 6.26234L16.7263 8.9375H7.3125C7.09701 8.9375 6.89035 9.0231 6.73798 9.17548C6.5856 9.32785 6.5 9.53451 6.5 9.75C6.5 9.96549 6.5856 10.1722 6.73798 10.3245C6.89035 10.4769 7.09701 10.5625 7.3125 10.5625H16.7263L14.0502 13.2377C13.8977 13.3901 13.812 13.5969 13.812 13.8125C13.812 14.0281 13.8977 14.2349 14.0502 14.3873C14.2026 14.5398 14.4094 14.6255 14.625 14.6255C14.8406 14.6255 15.0474 14.5398 15.1998 14.3873L19.2623 10.3248C19.3379 10.2494 19.3978 10.1598 19.4387 10.0611C19.4796 9.9625 19.5006 9.85678 19.5006 9.75C19.5006 9.64322 19.4796 9.5375 19.4387 9.43886C19.3978 9.34023 19.3379 9.25062 19.2623 9.17516Z"
                                                        fill="#111111" />
                                                </svg>
                                            </div>
                                            <div class="text">Log out</div>
                                        </a>
                                    </li>
                                </ul>
                            </div>
                        </div>
                    </div>
                </div>
                <!-- /section-menu-left -->
                <!-- section-content-right -->
                <div class="section-content-right">
                    <!-- header-dashboard -->
                    <div class="header-dashboard">
                        <div class="wrap">
                            <div class="header-left">
                                <a href="/admin/dashboard">
                                    <img style="width: 50px;" id="logo_header_mobile" alt=""
                                        src="/images/teraxo/logo.png" data-light="/images/teraxo/logo.png"
                                        data-dark="/images/teraxo/logo.png">
                                </a>
                                <div class="button-show-hide">
                                    <i class="icon-chevron-left"></i>
                                </div>
                            </div>
                            <div class="header-grid">
                                <div class="header-item button-dark-light">
                                    <i class="icon-moon"></i>
                                </div>


                                <div class="header-item button-zoom-maximize">
                                    <div class="">
                                        <i class="icon-maximize"></i>
                                    </div>
                                </div>
                                <div class="popup-wrap user type-header">
                                    <div class="dropdown">
                                        <button class="btn btn-secondary dropdown-toggle" type="button"
                                            id="dropdownMenuButton3" data-bs-toggle="dropdown" aria-expanded="false">
                                            <span class="header-user wg-user">
                                                <span class="image">
                                                    <img src="/images/teraxo/logo.png" alt="">
                                                </span>
                                                <span class="flex flex-column">
                                                    <span class="body-text text-main-dark">Blushely</span>
                                                    <span class="text-tiny">Admin</span>
                                                </span>
                                            </span>
                                        </button>
                                        <ul class="dropdown-menu dropdown-menu-end has-content"
                                            aria-labelledby="dropdownMenuButton3">

                                            <li>
                                                <a href="#" class="user-item">
                                                    <div class="icon">
                                                        <i class="icon-headphones"></i>
                                                    </div>
                                                    <div class="body-title-2">Support</div>
                                                </a>
                                            </li>
                                            <li>
                                                <a href="/admin/logout" class="user-item">
                                                    <div class="icon">
                                                        <i class="icon-log-out"></i>
                                                    </div>
                                                    <div class="body-title-2">Log out</div>
                                                </a>
                                            </li>
                                        </ul>
                                    </div>
                                </div>
                            </div>
                        </div>
                    </div>
                    <!-- /header-dashboard -->
               
                    <div class="main-content">
                        <div class="main-content-inner">
                            <div class="main-content-wrap">
                                <div class="flex items-center flex-wrap justify-between gap20 mb-30">
                                    <h3>Blog Management</h3>
                                    <ul class="breadcrumbs flex items-center flex-wrap justify-start gap10">
                                        <li><a href="/admin/dashboard">
                                                <div class="text-tiny">Dashboard</div>
                                            </a></li>
                                        <li><i class="icon-chevron-right"></i></li>
                                        <li>
                                            <div class="text-tiny">Blogs</div>
                                        </li>
                                    </ul>
                                </div>

                                <!-- Blog Management -->
                                <div class="wg-box">
                                    <div class="flex items-center justify-between gap10 flex-wrap">
                                        <div class="flex gap10">
                                            <a class="tf-button style-1 w208" href="#" onclick="showAddBlogModal()">
                                                <i class="icon-plus"></i>Add Blog
                                            </a>
                                        </div>
                                    </div>

                                    <div id="blog-list" style="display: grid; grid-template-columns: repeat(auto-fill, minmax(200px, 1fr)); gap: 20px; padding: 20px;">
                                        <!-- Blogs will be injected here dynamically -->
                                    </div>
                                </div>

                                <!-- Add Blog Modal -->
                                <div id="addBlogModal" class="modal">
                                    <div class="modal-content">
                                        <span class="close" onclick="closeModal('addBlogModal')">&times;</span>
                                        <h4>Add New Blog</h4>
                                        <form id="addBlogForm" enctype="multipart/form-data">
                                            <div class="form-group">
                                                <label for="blogTitle">Title</label>
                                                <input type="text" id="blogTitle" name="title" class="w-full">
                                            </div>
                                            <div class="form-group">
                                                <label for="blogImages">Images</label>
                                                <input type="file" id="blogImages" name="images" accept="image/*" multiple>
                                                <div class="text-tiny text-gray-500 mt-1">You can select multiple images; Only JPEG, JPG, PNG, WEBP allowed (Max 5MB each)</div>
                                            </div>
                                            <div class="form-group">
                                                <label for="blogCreatedBy">Created By</label>
                                                <input type="text" id="blogCreatedBy" name="createdBy" class="w-full">
                                            </div>
                                            <div class="form-group">
                                                <label for="blogDate">Date</label>
                                                <input type="date" id="blogDate" name="date" class="w-full">
                                            </div>
                                            <div class="form-group">
                                                <label for="blogDescription">Description</label>
                                                <textarea id="blogDescription" name="description" class="w-full" rows="3"></textarea>
                                            </div>
                                            <div class="form-group">
                                                <label for="blogMoreDescription">More Description</label>
                                                <textarea id="blogMoreDescription" name="moreDescription" class="w-full" rows="3"></textarea>
                                            </div>
                                            <div class="form-group">
                                                <label for="blogQuoteOfTheDay">Quote of the Day</label>
                                                <input type="text" id="blogQuoteOfTheDay" name="quoteOfTheDay" class="w-full">
                                            </div>
                                            <div class="form-group">
                                                <label for="blogSubTitle">Sub Title</label>
                                                <input type="text" id="blogSubTitle" name="subTitle" class="w-full">
                                            </div>
                                            <div class="form-group">
                                                <label for="blogSubDescription">Sub Description</label>
                                                <textarea id="blogSubDescription" name="subDescription" class="w-full" rows="2"></textarea>
                                            </div>
                                            <div class="form-group">
                                                <label for="blogTags">Tags (comma separated)</label>
                                                <input type="text" id="blogTags" name="tags" class="w-full" placeholder="e.g. beauty, skincare">
                                            </div>
                                            <div class="form-group">
                                                <label for="blogExtraPoints">Extra Points (comma separated)</label>
                                                <input type="text" id="blogExtraPoints" name="extraPoints" class="w-full" placeholder="e.g. tip 1, tip 2">
                                            </div>
                                            <div class="form-group">
                                                <label for="blogExtraTitle">Extra Title</label>
                                                <input type="text" id="blogExtraTitle" name="extraTitle" class="w-full">
                                            </div>
                                            <div class="form-group">
                                                <label for="blogSlug">Slug</label>
                                                <input type="text" id="blogSlug" name="slug" class="w-full">
                                            </div>
                                            <div class="form-group">
                                                <label for="blogSeoTitle">SEO Title</label>
                                                <input type="text" id="blogSeoTitle" name="seoTitle" class="w-full">
                                            </div>
                                            <div class="form-group">
                                                <label for="blogSeoDescription">SEO Description</label>
                                                <textarea id="blogSeoDescription" name="seoDescription" class="w-full" rows="2"></textarea>
                                            </div>
                                            <div class="form-group">
                                                <label for="blogSeoKeywords">SEO Keywords (comma separated)</label>
                                                <input type="text" id="blogSeoKeywords" name="seoKeywords" class="w-full" placeholder="e.g. skincare, health">
                                            </div>
                                            <button type="submit" class="tf-button style-1">Create Blog</button>
                                        </form>
                                    </div>
                                </div>

                                <!-- Edit Blog Modal -->
                                <div id="editBlogModal" class="modal">
                                    <div class="modal-content">
                                        <span class="close" onclick="closeModal('editBlogModal')">&times;</span>
                                        <h4>Edit Blog</h4>
                                        <form id="editBlogForm" enctype="multipart/form-data">
                                            <input type="hidden" id="editBlogId" name="id">
                                            <div class="form-group">
                                                <label for="editBlogTitle">Title</label>
                                                <input type="text" id="editBlogTitle" name="title" class="w-full">
                                            </div>
                                            <div class="form-group">
                                                <label for="editBlogImages">Images</label>
                                                <input type="file" id="editBlogImages" name="images" accept="image/*" multiple>
                                                <div class="text-tiny text-gray-500 mt-1">Leave empty to keep current images</div>
                                                <div id="currentBlogImagesPreview" class="mt-2"></div>
                                            </div>
                                            <div class="form-group">
                                                <label for="editBlogCreatedBy">Created By</label>
                                                <input type="text" id="editBlogCreatedBy" name="createdBy" class="w-full">
                                            </div>
                                            <div class="form-group">
                                                <label for="editBlogDate">Date</label>
                                                <input type="date" id="editBlogDate" name="date" class="w-full">
                                            </div>
                                            <div class="form-group">
                                                <label for="editBlogDescription">Description</label>
                                                <textarea id="editBlogDescription" name="description" class="w-full" rows="3"></textarea>
                                            </div>
                                            <div class="form-group">
                                                <label for="editBlogMoreDescription">More Description</label>
                                                <textarea id="editBlogMoreDescription" name="moreDescription" class="w-full" rows="3"></textarea>
                                            </div>
                                            <div class="form-group">
                                                <label for="editBlogQuoteOfTheDay">Quote of the Day</label>
                                                <input type="text" id="editBlogQuoteOfTheDay" name="quoteOfTheDay" class="w-full">
                                            </div>
                                            <div class="form-group">
                                                <label for="editBlogSubTitle">Sub Title</label>
                                                <input type="text" id="editBlogSubTitle" name="subTitle" class="w-full">
                                            </div>
                                            <div class="form-group">
                                                <label for="editBlogSubDescription">Sub Description</label>
                                                <textarea id="editBlogSubDescription" name="subDescription" class="w-full" rows="2"></textarea>
                                            </div>
                                            <div class="form-group">
                                                <label for="editBlogTags">Tags (comma separated)</label>
                                                <input type="text" id="editBlogTags" name="tags" class="w-full">
                                            </div>
                                            <div class="form-group">
                                                <label for="editBlogExtraPoints">Extra Points (comma separated)</label>
                                                <input type="text" id="editBlogExtraPoints" name="extraPoints" class="w-full">
                                            </div>
                                            <div class="form-group">
                                                <label for="editBlogExtraTitle">Extra Title</label>
                                                <input type="text" id="editBlogExtraTitle" name="extraTitle" class="w-full">
                                            </div>
                                            <div class="form-group">
                                                <label for="editBlogSlug">Slug</label>
                                                <input type="text" id="editBlogSlug" name="slug" class="w-full">
                                            </div>
                                            <div class="form-group">
                                                <label for="editBlogSeoTitle">SEO Title</label>
                                                <input type="text" id="editBlogSeoTitle" name="seoTitle" class="w-full">
                                            </div>
                                            <div class="form-group">
                                                <label for="editBlogSeoDescription">SEO Description</label>
                                                <textarea id="editBlogSeoDescription" name="seoDescription" class="w-full" rows="2"></textarea>
                                            </div>
                                            <div class="form-group">
                                                <label for="editBlogSeoKeywords">SEO Keywords (comma separated)</label>
                                                <input type="text" id="editBlogSeoKeywords" name="seoKeywords" class="w-full">
                                            </div>
                                            <button type="submit" class="tf-button style-1">Update Blog</button>
                                        </form>
                                    </div>
                                </div>

                                <script>
                                    let blogs = [];
            
                                    const parseCommaList = (value = "") =>
                                        value
                                            .split(",")
                                            .map((item) => item.trim())
                                            .filter(Boolean);
            
                                    const toCommaSeparated = (items = []) => {
                                        if (Array.isArray(items)) return items.join(", ");
                                        if (typeof items === "string") return items;
                                        return "";
                                    };
            
                                    const formatDate = (value) => {
                                        if (!value) return "";
                                        try {
                                            return new Date(value).toLocaleDateString();
                                        } catch {
                                            return "";
                                        }
                                    };

                                    // Helper to force setting input values (for browser autofill bugs)
                                    function setFieldValue(fieldId, value) {
                                        const el = document.getElementById(fieldId);
                                        if (!el) return;
                                        el.value = value ?? "";
                                        // For Reactivity/visibility bugs, force update event
                                        if ("createEvent" in document) {
                                            const evt = document.createEvent("HTMLEvents");
                                            evt.initEvent("input", false, true);
                                            el.dispatchEvent(evt);
                                        }
                                    }

                                    document.addEventListener("DOMContentLoaded", function () {
                                        fetchBlogs();
                                        setupBlogFormHandlers();
                                    });
            
                                    async function fetchBlogs() {
                                        try {
                                            // API: /admin-blog-list
                                            const response = await fetch("/api/admin-blog-list");
                                            if (!response.ok) throw new Error("Failed to fetch blogs");
                                            const payload = await response.json();
                                            blogs = Array.isArray(payload) ? payload : payload.blogs || [];
                                            renderBlogs();
                                        } catch (error) {
                                            console.error("Error loading blogs:", error);
                                            alert(error.message || "Error loading blogs");
                                        }
                                    }
            
                                    function parseImages(imgs) {
                                        if (!Array.isArray(imgs)) return [];
                                        if (
                                            imgs.length === 1 &&
                                            typeof imgs[0] === "string" &&
                                            imgs[0].trim().startsWith("[")
                                        ) {
                                            try {
                                                return JSON.parse(imgs[0]);
                                            } catch (err) {}
                                        }
                        
                                        return imgs.reduce((acc, cur) => {
                                            if (typeof cur === "string" && cur.trim().startsWith("[")) {
                                                try {
                                                    acc.push(...JSON.parse(cur));
                                                } catch {}
                                            } else {
                                                acc.push(cur);
                                            }
                                            return acc;
                                        }, []);
                                    }
            
                                    function parseStringOrArray(arr) {
                                        if (!Array.isArray(arr)) return [];
                                        if (
                                            arr.length === 1 &&
                                            typeof arr[0] === "string" &&
                                            arr[0].trim().startsWith("[")
                                        ) {
                                            try {
                                                const parsed = JSON.parse(arr[0]);
                                                if (Array.isArray(parsed)) return parsed;
                                            } catch {}
                                        }
                                        return arr.map(v => {
                                            if (typeof v === "string" && /^".*"$/.test(v.trim())) {
                                                return v.trim().slice(1, -1);
                                            }
                                            if (typeof v === "string" && v.trim().startsWith("[")) {
                                                try {
                                                    const parsed = JSON.parse(v);
                                                    if (Array.isArray(parsed)) return parsed;
                                                } catch {}
                                            }
                                            return v;
                                        }).flat().filter(Boolean);
                                    }
            
                                    function renderBlogs() {
                                        const blogList = document.getElementById("blog-list");
                                        if (!blogList) return;
            
                                        if (!blogs.length) {
                                            blogList.innerHTML = '<div class="text-center text-secondary py-4">No blogs found yet.</div>';
                                            return;
                                        }
            
                                        blogList.innerHTML = "";
            
                                        blogs.forEach((blog) => {
                                            const blogCard = document.createElement("div");
                                            blogCard.className = "card";
            
                                            let blogImages = parseImages(blog.images);
                                      
                                            let imageSrc = "/images/teraxo/logo.png";
                                            if (Array.isArray(blogImages) && blogImages.length > 0) {
                                                const img = blogImages[0];
                                                if (
                                                    img &&
                                                    !/^(https?:)?\/\//.test(img) &&
                                                    !img.startsWith("/images/") &&
                                                    !img.startsWith("/uploads/")
                                                ) {
                                                    imageSrc = "/uploads/" + img;
                                                } else {
                                                    imageSrc = img;
                                                }
                                            }
            
                                            const tagsList = parseStringOrArray(blog.tags);
                                            const extraPointsList = parseStringOrArray(blog.extraPoints);
                                            const authorName = blog.createdBy || "Unknown";
                                            const summarySource = blog.description || blog.moreDescription || "";
                                            const summary =
                                                blog.description
                                                    ? (blog.description.length > 140 ? `${blog.description.substring(0, 140)}…` : blog.description)
                                                    : (summarySource ? `${summarySource.substring(0, 140)}${summarySource.length > 140 ? "…" : ""}` : "");
            
                                            blogCard.innerHTML = `
                                                <div class="card-image" style="text-align:center;">
                                                    <img src="${imageSrc}" alt="${blog.title}" style="width:100%; max-width:220px; height:150px; object-fit:cover; border-radius:5px;">
                                                </div>
                                                <div class="card-content" style="padding:12px;">
                                                    <div class="flex items-center justify-between gap10 mb-2">
                                                        <span class="text-tiny text-gray-500">${formatDate(blog.date || blog.createdAt || blog.updatedAt)}</span>
                                                    </div>
                                                    <h4 class="card-title" style="margin:0 0 6px; font-size:16px; font-weight:bold;">${blog.title || ""}</h4>
                                                    <p class="card-author" style="margin:0 0 6px; color:darkgray;">By ${authorName}</p>
                                                    <p class="card-description" style="margin:0 0 8px; color:#555;">${summary}</p>
                                                </div>
                                                <div class="card-meta-block" style="padding:0 12px 12px;">
                                                    <div class="text-tiny text-secondary mb-1">Tags: ${tagsList.length ? tagsList.join(", ") : "—"}</div>
                                                    <div class="text-tiny text-secondary">Extra Points: ${extraPointsList.length ? extraPointsList.join(", ") : "—"}</div>
                                                </div>
                                                <div class="card-actions" style="display:flex; justify-content:space-between; gap:10px; padding:10px 12px 15px;">
                                                    <button style="background-color:#007bff; color:white; border:none; padding:6px 12px; border-radius:4px; cursor:pointer; flex:1;" onclick="showEditBlogModal('${blog._id}')">
                                                        <i class="icon-edit"></i> Edit
                                                    </button>
                                                    <button style="background-color:#dc3545; color:white; border:none; padding:6px 12px; border-radius:4px; cursor:pointer; flex:1;" onclick="confirmDeleteBlog('${blog._id}')">
                                                        <i class="icon-trash-2"></i> Delete
                                                    </button>
                                                </div>
                                            `;
                                            blogList.appendChild(blogCard);
                                        });
                                    }
            
                                    function showAddBlogModal() {
                                        const form = document.getElementById("addBlogForm");
                                        if (form) form.reset();
                                        document.getElementById("addBlogModal").style.display = "block";
                                    }
            
                                    function showEditBlogModal(id) {
                                        fetch(`/api/admin-blog/${id}`)
                                            .then((res) => {
                                                if (!res.ok) throw new Error("Failed to fetch blog details");
                                                return res.json();
                                            })
                                            .then((data) => {
                                                // For success style payloads
                                                let blog = data.blog ? data.blog : data;
                                                if (!blog) throw new Error("Blog not found");
                                                
                                                setFieldValue("editBlogId", blog._id || "");
                                                setFieldValue("editBlogTitle", blog.title || "");
                                                setFieldValue("editBlogCreatedBy", blog.createdBy || "");
                                                setFieldValue("editBlogDate", blog.date ? blog.date.substring(0, 10) : "");
                                                setFieldValue("editBlogDescription", blog.description || "");
                                                setFieldValue("editBlogMoreDescription", blog.moreDescription || "");
                                                setFieldValue("editBlogQuoteOfTheDay", blog.quoteOfTheDay || "");
                                                setFieldValue("editBlogSubTitle", blog.subTitle || "");
                                                setFieldValue("editBlogSubDescription", blog.subDescription || "");
                                                setFieldValue("editBlogTags", toCommaSeparated(blog.tags));
                                                setFieldValue("editBlogExtraPoints", toCommaSeparated(blog.extraPoints));
                                                setFieldValue("editBlogExtraTitle", blog.extraTitle || "");
                                                setFieldValue("editBlogSlug", blog.slug || "");
                                                setFieldValue("editBlogSeoTitle", blog.seoTitle || "");
                                                setFieldValue("editBlogSeoDescription", blog.seoDescription || "");
                                                setFieldValue("editBlogSeoKeywords", toCommaSeparated(blog.seoKeywords));
            
                                                // images preview - support both uploads and direct urls (relative/absolute)
                                                const preview = document.getElementById("currentBlogImagesPreview");
                                                if (preview) {
                                                    let imgs = Array.isArray(blog.images) ? blog.images : [];
                                                    if (imgs.length > 0) {
                                                        preview.innerHTML = `<p class="text-tiny">Current Images:</p>` +
                                                            imgs.map(src => {
                                                                let url = src;
                                                                if (
                                                                    src &&
                                                                    !/^(https?:)?\/\//.test(src) &&
                                                                    !src.startsWith("/images/") &&
                                                                    !src.startsWith("/uploads/")
                                                                ) {
                                                                    url = "/uploads/" + src;
                                                                }
                                                                return `<img src="${url}" alt="${blog.title}" class="w-full h-32 object-contain mt-1">`;
                                                            }).join("");
                                                    } else {
                                                        preview.innerHTML = '<p class="text-tiny text-gray-500">No images uploaded yet.</p>';
                                                    }
                                                }
            
                                                document.getElementById("editBlogModal").style.display = "block";
                                            })
                                            .catch((err) => {
                                                alert(err.message || "Error loading blog for editing");
                                            });
                                    }
            
                                    function closeModal(modalId) {
                                        document.getElementById(modalId).style.display = "none";
                                    }
            
                                    function setupBlogFormHandlers() {
                                        const addForm = document.getElementById("addBlogForm");
                                        const editForm = document.getElementById("editBlogForm");
            
                                        if (addForm) {
                                            addForm.addEventListener("submit", async function (e) {
                                                e.preventDefault();
            
                                                const formData = new FormData();
                                                formData.append("title", document.getElementById("blogTitle").value.trim());
                                                formData.append("createdBy", document.getElementById("blogCreatedBy").value.trim());
                                                formData.append("date", document.getElementById("blogDate").value);
                                                formData.append("description", document.getElementById("blogDescription").value.trim());
                                                formData.append("moreDescription", document.getElementById("blogMoreDescription").value.trim());
                                                formData.append("quoteOfTheDay", document.getElementById("blogQuoteOfTheDay").value.trim());
                                                formData.append("subTitle", document.getElementById("blogSubTitle").value.trim());
                                                formData.append("subDescription", document.getElementById("blogSubDescription").value.trim());
                                                formData.append("tags", JSON.stringify(parseCommaList(document.getElementById("blogTags").value)));
                                                formData.append("extraPoints", JSON.stringify(parseCommaList(document.getElementById("blogExtraPoints").value)));
                                                formData.append("extraTitle", document.getElementById("blogExtraTitle").value.trim());
                                                formData.append("slug", document.getElementById("blogSlug").value.trim());
                                                formData.append("seoTitle", document.getElementById("blogSeoTitle").value.trim());
                                                formData.append("seoDescription", document.getElementById("blogSeoDescription").value.trim());
                                                formData.append("seoKeywords", JSON.stringify(parseCommaList(document.getElementById("blogSeoKeywords").value)));
            
                                                const imageFiles = document.getElementById("blogImages")?.files;
                                                if (imageFiles && imageFiles.length > 0) {
                                                    for (let i = 0; i < imageFiles.length; i++) {
                                                        formData.append('images', imageFiles[i]);
                                                    }
                                                }
            
                                                try {
                                                    // API: /admin-blog-create (POST)
                                                    const response = await fetch("/api/admin-blog-create", {
                                                        method: "POST",
                                                        body: formData
                                                    });
                                                    const data = await response.json();
                                                    if (!response.ok || !data.success) {
                                                        throw new Error(data.error || "Failed to create blog");
                                                    }
                                                    blogs.unshift(data.blog);
                                                    renderBlogs();
                                                    closeModal("addBlogModal");
                                                    addForm.reset();
                                                    alert("Blog created successfully");
                                                } catch (error) {
                                                    console.error("Error:", error);
                                                    alert(error.message || "Error adding blog");
                                                }
                                            });
                                        }
            
                                        if (editForm) {
                                            editForm.addEventListener("submit", async function (e) {
                                                e.preventDefault();
            
                                                const id = document.getElementById("editBlogId").value;
                                                const formData = new FormData();
                                                formData.append("title", document.getElementById("editBlogTitle").value.trim());
                                                formData.append("createdBy", document.getElementById("editBlogCreatedBy").value.trim());
                                                formData.append("date", document.getElementById("editBlogDate").value);
                                                formData.append("description", document.getElementById("editBlogDescription").value.trim());
                                                formData.append("moreDescription", document.getElementById("editBlogMoreDescription").value.trim());
                                                formData.append("quoteOfTheDay", document.getElementById("editBlogQuoteOfTheDay").value.trim());
                                                formData.append("subTitle", document.getElementById("editBlogSubTitle").value.trim());
                                                formData.append("subDescription", document.getElementById("editBlogSubDescription").value.trim());
                                                formData.append("tags", JSON.stringify(parseCommaList(document.getElementById("editBlogTags").value)));
                                                formData.append("extraPoints", JSON.stringify(parseCommaList(document.getElementById("editBlogExtraPoints").value)));
                                                formData.append("extraTitle", document.getElementById("editBlogExtraTitle").value.trim());
                                                formData.append("slug", document.getElementById("editBlogSlug").value.trim());
                                                formData.append("seoTitle", document.getElementById("editBlogSeoTitle").value.trim());
                                                formData.append("seoDescription", document.getElementById("editBlogSeoDescription").value.trim());
                                                formData.append("seoKeywords", JSON.stringify(parseCommaList(document.getElementById("editBlogSeoKeywords").value)));
            
                                                const imageFiles = document.getElementById("editBlogImages")?.files;
                                                if (imageFiles && imageFiles.length > 0) {
                                                    for (let i = 0; i < imageFiles.length; i++) {
                                                        formData.append('images', imageFiles[i]);
                                                    }
                                                }
            
                                                try {
                                                    // API: /admin-blog/:id (PUT)
                                                    const response = await fetch(`/api/admin-blog/${id}`, {
                                                        method: "PUT",
                                                        body: formData
                                                    });
                                                    const data = await response.json();
                                                    if (!response.ok || !data.success) {
                                                        throw new Error(data.error || "Failed to update blog");
                                                    }
                                                    const index = blogs.findIndex((b) => b._id === id);
                                                    if (index !== -1) blogs[index] = data.blog;
                                                    renderBlogs();
                                                    closeModal("editBlogModal");
                                                    alert("Blog updated successfully");
                                                } catch (error) {
                                                    console.error("Error:", error);
                                                    alert(error.message || "Error updating blog");
                                                }
                                            });
                                        }
                                    }
            
                                    async function confirmDeleteBlog(id) {
                                        if (!confirm("Are you sure you want to delete this blog?")) return;
                                        try {
                                            // API: /admin-blog/:id (DELETE)
                                            const response = await fetch(`/api/admin-blog/${id}`, { method: "DELETE" });
                                            const data = await response.json();
                                            if (!response.ok || !data.success) {
                                                throw new Error(data.error || "Failed to delete blog");
                                            }
                                            blogs = blogs.filter((blog) => blog._id !== id);
                                            renderBlogs();
                                            alert("Blog deleted successfully");
                                        } catch (error) {
                                            console.error("Error:", error);
                                            alert(error.message || "Error deleting blog");
                                        }
                                    }
                                </script>
                            </div>
                        </div>
                    </div>

                 
                    <!-- /main-content -->
                </div>
                <!-- /section-content-right -->
            </div>
            <!-- /layout-wrap -->
        </div>
        <!-- /#page -->
    </div>
    <!-- /#wrapper -->
    <!-- Javascript -->
    <script src="/admin-js/jquery.min.js"></script>
    <script src="/admin-js/bootstrap.min.js"></script>
    <script src="/admin-js/bootstrap-select.min.js"></script>
    <script src="/admin-js/zoom.js"></script>
    <script src="/admin-js/switcher.js"></script>
    <script defer src="/admin-js/theme-settings.js"></script>
    <script defer src="/admin-js/main.js"></script>

</body>

</html>